---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiangxuechen
--- DateTime: 2023/07/31 14:33
--- Describe:
---

---@class RogueUnitEffect_AddDefaultBuff : RogueUnitSkillEffectBase
RogueUnitEffect_AddDefaultBuff = class(RogueUnitSkillEffectBase, "RogueUnitEffect_AddDefaultBuff")

---@public
---@param _action RogueUnitSkillActionBase
---@param _xls RogueUnitSkillEffect
function RogueUnitEffect_AddDefaultBuff:Init(_action, _xls)
	self:__Init(_action, _xls)
	local _list = {}
	local _params = _xls.params
	for i = 2, #_params do
		table.insert(_list, math.floor(_params[i]))
	end
	---@private
	---@type number[]
	self.__addBuffList = _list
end

---@public
---@param _targetObjList BattleObjectBase[]
function RogueUnitEffect_AddDefaultBuff:OnTrig(_targetObjList)
	self:__OnTrig(_targetObjList)

	local _battleRoom = self:GetBattleRoom()
	local _params = self:GetXlsData().params
	local _targetCamp = math.floor(_params[1])

	if CheckLogLevel(LogLevel.log) and LogTools.RogueUnitSkillLog then
		LogTools.LogByLevel(LogLevel.log, "肉鸽主公技", "    RogueUnitEffect_AddDefaultBuff:OnTrig", "Effect触发", "所属ActionId", self:GetAction():GetId(), "当前Effect ID", self:GetId(), "当前Effect类型", self:GetEffectTypeDesc(), "目标阵营", _targetCamp, LogTools.GetEnumTableDesc(BattleUnitCampType, _targetCamp), "buffGroupId列表", dumpTableEx(self.__addBuffList))
	end

	---@type BattleUnitBase[]
	local _unitList
	---@type BattleObjectBase[]
	local _objList
	---@type BattleObjCom_Buff
	local _buffCom
	
	_unitList = _battleRoom.battleUnitManager:GetUnitListByCampTypeUnsafe(_targetCamp)
	for _, _unit in pairs(_unitList) do
		_objList = _unit:GetAllObjectDic()
		for _, _obj in pairs(_objList) do
			_buffCom = _obj:GetComponent(BattleObjectComponentType.Buff)
			self:__DealAddBuff(_buffCom)
		end
	end
	
	if _targetCamp == BattleUnitCampType.Player then  --加给玩家
		self:__InsertDynamicDefaultBuff(_battleRoom.dynamicPlayerBuffIds)
	elseif _targetCamp == BattleUnitCampType.Monster then --加给怪物
		self:__InsertDynamicDefaultBuff(_battleRoom.dynamicMonsterBuffIds)
	end
end

---给现有的目标添加BUFF
---@private
---@param _buffCom BattleObjCom_Buff
function RogueUnitEffect_AddDefaultBuff:__DealAddBuff(_buffCom)
	if not _buffCom then return end
	
	local _list = self.__addBuffList
	for i = 1, #_list do
		_buffCom:AddBattleBuffById(_list[i])
	end
end

---添加到天生BUFF列表，以使后面创建出来的单位生效
---@private
function RogueUnitEffect_AddDefaultBuff:__InsertDynamicDefaultBuff(_dynamicList)
	if not _dynamicList then return end
	
	local _list = self.__addBuffList
	for i = 1, #_list do
		table.insert(_dynamicList, _list[i])
	end
end

return RogueUnitEffect_AddDefaultBuff