---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiangxuechen
--- DateTime: 2023/07/28 14:29
--- Describe:
---

require "Battle/Logic/RogueUnitSkill/RogueUnitSkillData"
require "Battle/Logic/RogueUnitSkill/EnergyCollector/RogueUnitSkillEnergyCollectorBase"
require "Battle/Logic/RogueUnitSkill/EnergyCollector/RogueUnitEnCollector_SkillEleTypeHeroCastSkillType"
require "Battle/Logic/RogueUnitSkill/EnergyCollector/RogueUnitEnCollector_SpecificEleTypeHeroCastSkillType"
require "Battle/Logic/RogueUnitSkill/EnergyCollector/RogueUnitEnCollector_SelfKillMons"
require "Battle/Logic/RogueUnitSkill/EnergyCollector/RogueUnitEnCollector_SelfDestroyBullet"
require "Battle/Logic/RogueUnitSkill/Actions/RogueUnitSkillActionBase"
require "Battle/Logic/RogueUnitSkill/Actions/RogueUnitSkillTrigger"
require "Battle/Logic/RogueUnitSkill/TargetSelectors/RogueUnitSkillTargetSelectorBase"
require "Battle/Logic/RogueUnitSkill/TargetSelectors/RogueUnitTarget_Rand"
require "Battle/Logic/RogueUnitSkill/TargetSelectors/RogueUnitTarget_NotRand"
require "Battle/Logic/RogueUnitSkill/TargetSelectors/RogueUnitTarget_SpecificElement"
require "Battle/Logic/RogueUnitSkill/TargetSelectors/RogueUnitTarget_SpecificBuffId"
require "Battle/Logic/RogueUnitSkill/TargetSelectors/RogueUnitTarget_ListenBuffStackNumIncrease"
require "Battle/Logic/RogueUnitSkill/TargetSelectors/RogueUnitTarget_ElementAttach"
require "Battle/Logic/RogueUnitSkill/Effects/RogueUnitSkillEffectBase"
require "Battle/Logic/RogueUnitSkill/Effects/RogueUnitEffect_AddAction"
require "Battle/Logic/RogueUnitSkill/Effects/RogueUnitEffect_AddBuff"
require "Battle/Logic/RogueUnitSkill/Effects/RogueUnitEffect_AddEffect"
require "Battle/Logic/RogueUnitSkill/Effects/RogueUnitEffect_ChangeActionTriggerCD"
require "Battle/Logic/RogueUnitSkill/Effects/RogueUnitEffect_ChangeEffect"
require "Battle/Logic/RogueUnitSkill/Effects/RogueUnitEffect_AddUnitBuff"
require "Battle/Logic/RogueUnitSkill/Effects/RogueUnitEffect_ChangeBuffStackNumLimit"
require "Battle/Logic/RogueUnitSkill/Effects/RogueUnitEffect_RemoveAction"
require "Battle/Logic/RogueUnitSkill/Effects/RogueUnitEffect_AddDefaultBuff"


---@class Enum_RogueUnitSkillEffectType : table
Enum_RogueUnitSkillEffectType = {
	AddBuff = 1,                  --添加BUFF
	AddEffect = 2,                --添加效果
	ChangeEffect = 3,             --修改效果
	ChangeBuffStackNumLimit = 4,  --修改BUFF堆叠上限
	ChangeActionTriggerCD = 5,    --修改触发间隔
	AddAction = 6,                --添加行为
	AddUnitBuff = 7,              --添加玩家BUFF
	RemoveAction = 8,             --移除Action
	AddDefaultBuff = 9,           --添加天生BUFF
}

---@class Enum_RogueUnitSkillTargetSelectorType : table
Enum_RogueUnitSkillTargetSelectorType = {
	Random = 1,                    --随机
	NotRandom = 2,                 --不随机
	SpecificElementId = 3,         --指定元素类型
	SpecificBuffGroupId = 4,       --指定携带GroupId的BUFF
	ListenBuffStackIncrease = 5,   --指定BUFF叠层增加
	SpecificEleAttach = 6,         --指定元素附着
}

---@class Enum_RogueUnitSkillSelectOnTeamType : table
Enum_RogueUnitSkillSelectOnTeamType = {
	OnTeamAndOffTeam = 0,           --阵上阵下
	OnTeam = 1,                     --阵上
	OffTeam = 2,                    --阵下
}

---@class Enum_RogueUnitSkillEnergyCollectorType : table
Enum_RogueUnitSkillEnergyCollectorType = {
	SkillEleTypeHeroCastSkillType = 1,       --同元素属性英雄施放指定类型的技能
	SpecificEleTypeHeroCastSkillType = 2,    --指定元素属性英雄施放指定类型的技能
	SelfKillMons = 3,                        --自身打死怪物
	SelfDestroyBullet = 4,                   --自身闪避消弹(同时多个只触发一次)
	ListenBuffStackNumIncrease = 5,          --监听指定buff叠层
	ElementAttach = 6,                       --拥有元素附着
}

---@class RogueUnitSkillService : table
RogueUnitSkillService = class(nil, "RogueUnitSkillService")
function RogueUnitSkillService:ctor(_battleId)
	 ---@type number
    self.battleId = _battleId
	---@type BattleRoom
    self.battleRoom = GetBattleRoom(self.battleId)
	---@private
	---@type RogueUnitSkillEnergyCollectorBase[][]
	self.__listener = {}
end

---@public
---@param _eventId number 事件ID
---@param _caller RogueUnitSkillEnergyCollectorBase 事件接收者
function RogueUnitSkillService:AddListener(_eventId, _caller)
	local _tab = self.__listener[_eventId]
	if not _tab then
		_tab = {}
		self.__listener[_eventId] = _tab
	end
	table.insert(_tab, _caller)
end

---@public
---@param _eventId number 事件ID
---@param _caller RogueUnitSkillEnergyCollectorBase 事件接收者 
function RogueUnitSkillService:RemoveListener(_eventId, _caller)
	local _tab = self.__listener[_eventId]
	if not _tab then return end
	for _index, _value in pairs(_tab) do
		if _value == _caller then
			table.remove(_tab, _index)
			return
		end
	end
end

---@public
---@param _battleLogicEventV2 BattleLogicEventV2
function RogueUnitSkillService:OnTrigEvent(_battleLogicEventV2)
	
	local _eventId = _battleLogicEventV2.eventType
	local _tab = self.__listener[_eventId]
	if not _tab then return end
	for _, _caller in pairs(_tab) do
		_caller:OnTrigEvent(_battleLogicEventV2)
	end
end

---@public
---@return RogueUnitSkillData
function RogueUnitSkillService:GenerateRogueUnitSkill(_type)
	return RogueUnitSkillData.New()
end

---@public
---@param _type Enum_RogueUnitSkillEnergyCollectorType
---@return RogueUnitSkillEnergyCollectorBase
function RogueUnitSkillService:GenerateRogueUnitSkillEnergyCollector(_type)
	
	local _collector

	if _type == Enum_RogueUnitSkillEnergyCollectorType.SkillEleTypeHeroCastSkillType then
		_collector = RogueUnitEnCollector_SkillEleTypeHeroCastSkillType.New()
	elseif _type == Enum_RogueUnitSkillEnergyCollectorType.SpecificEleTypeHeroCastSkillType then
		_collector = RogueUnitEnCollector_SpecificEleTypeHeroCastSkillType.New()
	elseif _type == Enum_RogueUnitSkillEnergyCollectorType.SelfKillMons then
		_collector = RogueUnitEnCollector_SelfKillMons.New()
	elseif _type == Enum_RogueUnitSkillEnergyCollectorType.SelfDestroyBullet then
		_collector = RogueUnitEnCollector_SelfDestroyBullet.New()
	end
	
	return _collector
	
end

---@public
---@return RogueUnitSkillActionBase
function RogueUnitSkillService:GenerateRogueUnitSkillAction(_type)
	return RogueUnitSkillActionBase.New()
end

---@public
---@param _type Enum_RogueUnitSkillEffectType
---@return RogueUnitSkillEffectBase
function RogueUnitSkillService:GenerateRogueUnitSkillEffect(_type)

	local _effect
	
	if _type == Enum_RogueUnitSkillEffectType.ChangeBuffStackNumLimit then
		_effect = RogueUnitEffect_ChangeBuffStackNumLimit.New()
	elseif _type == Enum_RogueUnitSkillEffectType.AddBuff then
		_effect = RogueUnitEffect_AddBuff.New()
	elseif _type == Enum_RogueUnitSkillEffectType.ChangeActionTriggerCD then
		_effect = RogueUnitEffect_ChangeActionTriggerCD.New()
	elseif _type == Enum_RogueUnitSkillEffectType.AddEffect then
		_effect = RogueUnitEffect_AddEffect.New()
	elseif _type == Enum_RogueUnitSkillEffectType.ChangeEffect then
		_effect = RogueUnitEffect_ChangeEffect.New()
	elseif _type == Enum_RogueUnitSkillEffectType.AddAction then
		_effect = RogueUnitEffect_AddAction.New()
	elseif _type == Enum_RogueUnitSkillEffectType.AddUnitBuff then
		_effect = RogueUnitEffect_AddUnitBuff.New()
	elseif _type == Enum_RogueUnitSkillEffectType.RemoveAction then
		_effect = RogueUnitEffect_RemoveAction.New()
	elseif _type == Enum_RogueUnitSkillEffectType.AddDefaultBuff then
		_effect = RogueUnitEffect_AddDefaultBuff.New()
	end
	
	return _effect
end

---@public
---@param _type Enum_RogueUnitSkillTargetSelectorType
---@return RogueUnitSkillTargetSelectorBase
function RogueUnitSkillService:GenerateRogueUnitSkillTargetSelector(_type)
	local _selector

	if _type == Enum_RogueUnitSkillTargetSelectorType.Random then
		_selector = RogueUnitTarget_Rand.New()
	elseif _type == Enum_RogueUnitSkillTargetSelectorType.NotRandom then
		_selector = RogueUnitTarget_NotRand.New()
	elseif _type == Enum_RogueUnitSkillTargetSelectorType.SpecificElementId then
		_selector = RogueUnitTarget_SpecificElement.New()
	elseif _type == Enum_RogueUnitSkillTargetSelectorType.SpecificBuffGroupId then
		_selector = RogueUnitTarget_SpecificBuffId.New()
	elseif _type == Enum_RogueUnitSkillTargetSelectorType.ListenBuffStackIncrease then
		_selector = RogueUnitTarget_ListenBuffStackNumIncrease.New()
	elseif _type == Enum_RogueUnitSkillTargetSelectorType.SpecificEleAttach then
		_selector = RogueUnitTarget_ElementAttach.New()
	end
	
	return _selector
end

function RogueUnitSkillService:OnUpdate(_deltaTime)
end
return RogueUnitSkill