---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiangxuechen
--- DateTime: 2023/07/28 15:02
--- Describe:
---

---@class RogueUnitEffect_AddBuff : RogueUnitSkillEffectBase
RogueUnitEffect_AddBuff = class(RogueUnitSkillEffectBase, "RogueUnitEffect_AddBuff")

---@private
function RogueUnitEffect_AddBuff:__InitBuffCastTemplates()
	local _castObj = self:GetUnit():GetCurrentHeroObject()
	--todo:这里先不传试试~~
	local _rogueSkillId = self:GetAction():GetRogueUnitSkill():GetId()
	local _tab = {}
	local _xls = self:GetXlsData()
	for i = 1, #_xls.params do
		local _buffCastTemplate = BattleBuffService:GenerateCastBuffTemplate(math.floor(_xls.params[i]), _castObj, nil)
		table.insert(_tab, _buffCastTemplate)
	end
	---@private
	---@type BattleBuffCastTemplate[]
	self.__buffCastTemplateList = _tab
end

---@public
---@param _targetObjList BattleObjectBase[]
function RogueUnitEffect_AddBuff:OnTrig(_targetObjList)
	self:__OnTrig(_targetObjList)
	if not self.__buffCastTemplateList then
		---这里不能放到INIT中进行，因为在Unit创建时就先把effect信息初始化好了，此时unit还没加到UnitManager的列表中，会出现buff找不到施法者unit的情况
		self:__InitBuffCastTemplates()
	end
	
	if CheckLogLevel(LogLevel.log) and LogTools.RogueUnitSkillLog then
		LogTools.LogByLevel(LogLevel.log, "肉鸽主公技", "    RogueUnitEffect_AddBuff:OnTrig", "Effect触发", "所属ActionId", self:GetAction():GetId(), "当前Effect ID", self:GetId(), "当前Effect类型", self:GetEffectTypeDesc(), "_targetObjList", #_targetObjList)
	end
	
	for _, _obj in pairs(_targetObjList) do
		if CheckLogLevel(LogLevel.log) and LogTools.RogueUnitSkillLog then
			LogTools.LogByLevel(LogLevel.log, "肉鸽主公技", "    RogueUnitEffect_AddBuff:__dealAddBuff", "_obj", _obj:GetObjectId())
		end
		self:__dealAddBuff(_obj:GetComponent(BattleObjectComponentType.Buff))
	end
end

---@private
---@param _buffCom BattleObjCom_Buff
function RogueUnitEffect_AddBuff:__dealAddBuff(_buffCom)
	if not _buffCom then return end
	
	local _list = self.__buffCastTemplateList
	for i = 1, #_list do
		if CheckLogLevel(LogLevel.log) and LogTools.RogueUnitSkillLog then
			LogTools.LogByLevel(LogLevel.log, "肉鸽主公技", "    RogueUnitEffect_AddBuff:__dealAddBuff", "targetNetId", _buffCom:GetObject():GetParentUnit():GetNetId(), "targetObjId", _buffCom:GetObject():GetObjectId(), "buffGroupId", _list[i].buffGroupId)
		end
		_buffCom:AddBattleBuff(_list[i])
	end
end

return RogueUnitEffect_AddBuff