---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiangxuechen
--- DateTime: 2023/07/29 17:11
--- Describe:
---

---@class RogueUnitEnCollector_SelfKillMons : RogueUnitSkillEnergyCollectorBase
RogueUnitEnCollector_SelfKillMons = class(RogueUnitSkillEnergyCollectorBase, "RogueUnitEnCollector_SelfKillMons")

---@public
---@param _rogueUnitSkill RogueUnitSkillData
---@param _enCollectorXls RogueUnitSkillEnCollector
function RogueUnitEnCollector_SelfKillMons:Init(_rogueUnitSkill, _enCollectorXls)
	self:__Init(_rogueUnitSkill, _enCollectorXls)
	
	self.__checkNetId = _rogueUnitSkill:GetUnit():GetNetId()
	self:GetBattleRoom().rogueUnitSkillService:AddListener(BATTLE_LOGIC_EVENT_ENUM.BATTLE_UNIT_DEAD, self)
end

---@public
function RogueUnitEnCollector_SelfKillMons:OnRemove()
	self:__OnRemove()
	self:GetBattleRoom().rogueUnitSkillService:RemoveListener(BATTLE_LOGIC_EVENT_ENUM.BATTLE_UNIT_DEAD, self)
end

---@public
---@param _battleLogicEventV2 BattleLogicEventV2
function RogueUnitEnCollector_SelfKillMons:OnTrigEvent(_battleLogicEventV2)
	self:__OnTrigEvent(_battleLogicEventV2)

	local _unit = self:GetBattleRoom().battleUnitManager:GetUnit(_battleLogicEventV2.netId, true)
	---@type BattleUnitCom_TagSelector
	local _tagCom = _unit:GetComponent(BattleUnitComponentType.TagSelector)
	if not _tagCom then return end
	local _lastHurtNetId = _tagCom:GetTag(BattleUnitTagEnum.LastHurtFromNetID)
	if _lastHurtNetId ~= self.__checkNetId then return end

	if CheckLogLevel(LogLevel.log) and LogTools.RogueUnitSkillLog then
		LogTools.LogByLevel(LogLevel.logErr, "肉鸽主公技", "击杀怪物增加主公技能量", "死亡对象NetId", _battleLogicEventV2.netId, "添加属性", self.__addPropId, self.__addPropStr, "添加数量", self.__addPropNum)
	end
	self.__unitPropCom:IncreasePropByName(self.__addPropStr, self.__addPropNum)
end

return RogueUnitEnCollector_SelfKillMons