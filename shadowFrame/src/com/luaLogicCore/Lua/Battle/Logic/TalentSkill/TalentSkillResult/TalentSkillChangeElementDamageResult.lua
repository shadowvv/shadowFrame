---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zhaopuyang.
--- DateTime: 2022/5/10 16:29

require "Lib/class"
require "Battle/Logic/TalentSkill/TalentSkillResult/TalentSkillResultBase"

---@class TalentSkillChangeElementDamageResult : TalentSkillResultBase
TalentSkillChangeElementDamageResult = class(TalentSkillResultBase, 'TalentSkillChangeElementDamageResult');

function TalentSkillChangeElementDamageResult:ctor(_battleId)
    self.battleId = _battleId
    self.battleRoom = GetBattleRoom(self.battleId)
end

---触发被动技能
---@public
---@param _battleObjectBase BattleObjectBase
---@param _count number
---@param _talentSkillConfig TalentSkill
---@param _skillResult SkillResult
---@param _talentSkill BattlePlayerTalentSkill 被动技能
---@param _isReTrigger boolean 重新触发
function TalentSkillChangeElementDamageResult:Trigger(_battleObjectBase,_count,_talentSkillConfig,_skillResult,_talentSkill,_isReTrigger)
    ---@type Leader
    local leader = _battleObjectBase:GetInstanceXls();
    if leader then
        local propId = leader.property;
        if leader.property == BattleElementTypeEnum.NONE:GetId() then
            return;
        elseif leader.property == BattleElementTypeEnum.FIRE:GetId() then
            propId = ProtoEnumTool.GetPropertyId(BattlePropertyEnum.HurtAdd_Element_Fire);
        elseif leader.property == BattleElementTypeEnum.ICE:GetId() then
            propId = ProtoEnumTool.GetPropertyId(BattlePropertyEnum.HurtAdd_Element_Ice);
        elseif leader.property == BattleElementTypeEnum.PHYSIC:GetId() then
            propId = ProtoEnumTool.GetPropertyId(BattlePropertyEnum.HurtAdd_Normal);
        elseif leader.property == BattleElementTypeEnum.STORM:GetId() then
            propId = ProtoEnumTool.GetPropertyId(BattlePropertyEnum.HurtAdd_Element_Wind);
        elseif leader.property == BattleElementTypeEnum.THUNDER:GetId() then
            propId = ProtoEnumTool.GetPropertyId(BattlePropertyEnum.HurtAdd_Element_Thunder);
        end

        for i, v in pairs(_battleObjectBase:GetParentUnit():GetAllObjectDic()) do
            if v:GetObjectId() ~= _battleObjectBase:GetObjectId() then
                ---@type BattleObjCom_Property
                local propComp = v:GetComponent(BattleObjectComponentType.Property);
                if propComp then
                    propComp:AddAdditionValueById(propId,_skillResult.parm1/100*_count);
                end
            end
        end
        _talentSkill:AddTriggeredObject(_battleObjectBase:GetObjectId(),_count);
    end

end

---释放被动技能
---@public
---@param _skillResult SkillResult
---@param _targetObjectId number 伤害目标objectId
---@param _count number 触发次数
---@param _talentSkill BattlePlayerTalentSkill
function TalentSkillChangeElementDamageResult:Release(_skillResult, _targetObjectId,_count,_talentSkill)
    ---@type BattleObjectBase
    local targetObject = self.battleRoom.battleObjectManager:GetObject(_targetObjectId);
    if targetObject then
        ---@type Leader
        local leader = targetObject:GetInstanceXls();
        if leader then
            local propId = leader.property;
            if leader.property == BattleElementTypeEnum.NONE:GetId() then
                return;
            elseif leader.property == BattleElementTypeEnum.FIRE:GetId() then
                propId = ProtoEnumTool.GetPropertyId(BattlePropertyEnum.HurtAdd_Element_Fire);
            elseif leader.property == BattleElementTypeEnum.ICE:GetId() then
                propId = ProtoEnumTool.GetPropertyId(BattlePropertyEnum.HurtAdd_Element_Ice);
            elseif leader.property == BattleElementTypeEnum.PHYSIC:GetId() then
                propId = ProtoEnumTool.GetPropertyId(BattlePropertyEnum.HurtAdd_Normal);
            elseif leader.property == BattleElementTypeEnum.STORM:GetId() then
                propId = ProtoEnumTool.GetPropertyId(BattlePropertyEnum.HurtAdd_Element_Wind);
            elseif leader.property == BattleElementTypeEnum.THUNDER:GetId() then
                propId = ProtoEnumTool.GetPropertyId(BattlePropertyEnum.HurtAdd_Element_Thunder);
            end

            for i, v in pairs(targetObject:GetParentUnit():GetAllObjectDic()) do
                if v:GetObjectId() ~= targetObject:GetObjectId() then
                    ---@type BattleObjCom_Property
                    local propComp = v:GetComponent(BattleObjectComponentType.Property);
                    if propComp then
                        propComp:AddAdditionValueById(propId,_skillResult.parm1/100*-1*_count);
                    end
                end
            end
        end
    end
end


---被动技能触发类型
---@return number 被动技能触发类型
function TalentSkillChangeElementDamageResult:GetType()
    return 18;
end

return TalentSkillChangeElementDamageResult;