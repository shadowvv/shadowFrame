---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zhaopuyang.
--- DateTime: 2022/8/24 11:41

require "Lib/class"

---@class TalentSkillInSprintActionTrigger : table
TalentSkillInSprintActionTrigger = class(nil, 'TalentSkillInSprintActionTrigger');

function TalentSkillInSprintActionTrigger:ctor(_battleId)
    ---@type number
    self.battleId = _battleId
    self.battleRoom = GetBattleRoom(self.battleId)

end

---@public
---@param _battleObject BattleObjectBase 触发单位
---@param _talentSkillTrigger SkillTrigger 被动技能配置
---@param _talentSkill BattlePlayerTalentSkill 被动技能
function TalentSkillInSprintActionTrigger:Check(_battleObject, _talentSkillTrigger,_talentSkill)
    if not _talentSkillTrigger.parm1 or _talentSkillTrigger.parm1 == 0 then
        ---@type MoveActionState
        local moveState = _battleObject:GetParentUnit():GetActionManager():GetCurrentMoveState();
        if moveState and moveState:GetId() == SprintActionState:GetId() then
            if not _talentSkillTrigger.parm7 or _talentSkillTrigger.parm7 == 0 then
                return 1;
            end
            if _talentSkillTrigger.parm7 == BATTLE_TALENT_SKILL_TRIGGER_SOURCE.self and _battleObject:GetObjectId() == _battleObject:GetParentUnit():GetCurrentHeroObjectId() then
                return 1;
            end
            if _talentSkillTrigger.parm7 == BATTLE_TALENT_SKILL_TRIGGER_SOURCE.teamOne then
                return 1;
            end
            if _talentSkillTrigger.parm7 == BATTLE_TALENT_SKILL_TRIGGER_SOURCE.teamOther and _battleObject:GetObjectId() ~= _battleObject:GetParentUnit():GetCurrentHeroObjectId() then
                return 1;
            end
        end
    end
    local isLeave = false;
    if _talentSkillTrigger.parm1 == 2 then
        isLeave = true;
    end
    if _talentSkillTrigger.parm1 == 1 then
        if _talentSkillTrigger.parm7 == BATTLE_TALENT_SKILL_TRIGGER_SOURCE.self and self.battleRoom.battleLogicEventService:CheckChangeStateEvent(SprintActionState:GetId(),isLeave,_battleObject:GetParentUnit():GetNetId(), _battleObject:GetObjectId()) then
            return 1;
        end
        if _talentSkillTrigger.parm7 == BATTLE_TALENT_SKILL_TRIGGER_SOURCE.teamOne and self.battleRoom.battleLogicEventService:CheckChangeStateEvent(SprintActionState:GetId(),isLeave,_battleObject:GetParentUnit():GetNetId()) then
            return 1;
        end
        if _talentSkillTrigger.parm7 == BATTLE_TALENT_SKILL_TRIGGER_SOURCE.teamOther then
            for i, v in pairs(_battleObject:GetParentUnit():GetAllObjectDic()) do
                if v:GetObjectId() ~= _battleObject:GetObjectId() and self.battleRoom.battleLogicEventService:CheckChangeStateEvent(SprintActionState:GetId(),isLeave,_battleObject:GetParentUnit():GetNetId(), v:GetObjectId()) then
                    return 1;
                end
            end
        end
    end
    return 0;
end

---@public
function TalentSkillInSprintActionTrigger:Reset()

end

---被动技能触发类型
---@return number 被动技能触发类型
function TalentSkillInSprintActionTrigger:GetType()
    return 133;
end

return TalentSkillInSprintActionTrigger;