---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zhaopuyang.
--- DateTime: 2022/8/24 11:41

require "Lib/class"

---@class TalentSkillRemoveBuffTrigger : table
TalentSkillRemoveBuffTrigger = class(nil, 'TalentSkillOnBuffTrigger');

function TalentSkillRemoveBuffTrigger:ctor(_battleId)
    ---@type number
    self.battleId = _battleId
    self.battleRoom = GetBattleRoom(self.battleId)
    self.lastTriggerTime = TimeUtils.battleNow(self.battleId);
    self.count = 0;
end

---@public
---击中目标回调
---@param _talentSkillTrigger SkillTrigger
---@param _buffId number buffId
---@param _stackNum number buff层数
---@param _isTimeOver boolean 是否正常结束
function TalentSkillRemoveBuffTrigger:onBuffOver(_talentSkillTrigger, _buffId, _stackNum, _isTimeOver)

    if TimeUtils.battleNow(self.battleId) - self.lastTriggerTime < _talentSkillTrigger.parm6 then
        return;
    end

    if _talentSkillTrigger.parm1 ~= _buffId then
        return;
    end

    if _talentSkillTrigger.parm2 and _talentSkillTrigger.parm2 > _stackNum then
        return;
    end

    if _talentSkillTrigger.parm3 and _talentSkillTrigger.parm3 ~= _isTimeOver then
        return;
    end

    self.count = self.count + 1;
    self.lastTriggerTime = TimeUtils.battleNow(self.battleId);
end

---@public
---@param _battleObject BattleObjectBase 触发单位
---@param _talentSkillTrigger SkillTrigger 被动技能配置
---@param _talentSkill BattlePlayerTalentSkill 被动技能
function TalentSkillRemoveBuffTrigger:Check(_battleObject, _talentSkillTrigger,_talentSkill)
    if self.count <= 0 then
        return 0;
    end
    self:Reset();
    return 1;
end

---@public
function TalentSkillRemoveBuffTrigger:Reset()
    self.count = 0;
end

---被动技能触发类型
---@return number 被动技能触发类型
function TalentSkillRemoveBuffTrigger:GetType()
    return 114;
end

return TalentSkillOnBuffTrigger;