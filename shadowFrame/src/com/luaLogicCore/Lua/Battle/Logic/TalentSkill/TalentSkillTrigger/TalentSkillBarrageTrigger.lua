---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zhaopuyang.
--- DateTime: 2022/11/1 15:57

require "Lib/class"

---@class TalentSkillBarrageTrigger : table
TalentSkillBarrageTrigger = class(nil, 'TalentSkillBarrageTrigger');

function TalentSkillBarrageTrigger:ctor(_battleId)
    ---@type number
    self.battleId = _battleId
    self.battleRoom = GetBattleRoom(self.battleId)
    self.lastTriggerTime = TimeUtils.battleNow(self.battleId);
    self.count = 0;
end

---@public
---击中目标回调
---@param _talentSkillTrigger SkillTrigger
---@param _skillId number 伤害目标netId
---@param _barrageId number 发射器id
function TalentSkillBarrageTrigger:OnCreateBarrage(_talentSkillTrigger, _skillId,_barrageId)
    if TimeUtils.battleNow(self.battleId) - self.lastTriggerTime < _talentSkillTrigger.parm6 then
        return;
    end

    if _talentSkillTrigger.parm1 and _talentSkillTrigger.parm1 ~= 0 and _skillId ~= _talentSkillTrigger.parm1 then
        return;
    end

    if _talentSkillTrigger.parm3 and _talentSkillTrigger.parm3 ~= 0 and _barrageId ~= _talentSkillTrigger.parm3 then
        return;
    end

    self.count = self.count + 1;
    self.lastTriggerTime = TimeUtils.battleNow(self.battleId);
end

---@public
---@param _battleObject BattleObjectBase 触发单位
---@param _talentSkillTrigger SkillTrigger 被动技能配置
---@param _talentSkill BattlePlayerTalentSkill 被动技能
function TalentSkillBarrageTrigger:Check(_battleObject, _talentSkillTrigger,_talentSkill)
    if _talentSkillTrigger.parm2 > self.count then
        return 0;
    end
    local count = math.floor(self.count / _talentSkillTrigger.parm2);
    self:Reset();
    return count;
end

---@public
function TalentSkillBarrageTrigger:Reset()
    self.count = 0;
end

---被动技能触发类型
---@return number 被动技能触发类型
function TalentSkillBarrageTrigger:GetType()
    return 117;
end

return TalentSkillBarrageTrigger;