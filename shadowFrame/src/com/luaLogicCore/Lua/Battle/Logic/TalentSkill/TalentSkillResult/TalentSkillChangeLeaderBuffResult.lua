---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by guokun
--- DateTime: 2022/6/28 16:06

require "Lib/class"

---@class TalentSkillChangeLeaderBuffResult : TalentSkillResultBase
TalentSkillChangeLeaderBuffResult = class(TalentSkillResultBase, 'TalentSkillChangeLeaderBuffResult');

function TalentSkillChangeLeaderBuffResult:ctor(_battleId)
    self.battleId = _battleId
    self.battleRoom = GetBattleRoom(self.battleId)
end

---触发被动技能
---@public
---@param _battleObjectBase BattleObjectBase
---@param _count number
---@param _talentSkillConfig TalentSkill
---@param _skillResult SkillResult
---@param _talentSkill BattlePlayerTalentSkill 被动技能
---@param _isReTrigger boolean 重新触发
function TalentSkillChangeLeaderBuffResult:Trigger(_battleObjectBase,_count,_talentSkillConfig,_skillResult,_talentSkill,_isReTrigger)
    local buffId = _skillResult.parm1;
    
    ---@type BattleObjCom_Buff
    local buffComp = _battleObjectBase:GetComponent(BattleObjectComponentType.Buff);
    if buffComp and not buffComp:HasBuffChangeLeader(buffId) then
        for i = 1, _count do
            buffComp:AddBuffChangeLeader(BattleBuffService:GenerateCastBuffTemplate(buffId,_battleObjectBase,nil,nil,nil))
        end
    end
end

---释放被动技能
---@public
---@param _skillResult SkillResult
---@param _targetObjectId number 伤害目标objectId
---@param _count number 触发次数
---@param _talentSkill BattlePlayerTalentSkill
function TalentSkillChangeLeaderBuffResult:Release(_skillResult, _targetObjectId,_count,_talentSkill)
    ---@type BattleObjectBase
    local targetObject = self.battleRoom.battleObjectManager:GetObject(_targetObjectId);
    if targetObject then
        ---@type BattleObjCom_Buff
        local buffComp = targetObject:GetComponent(BattleObjectComponentType.Buff);
        if buffComp then
            for i = 1,_count do
                buffComp:RemoveBuffChangeLeader(_skillResult.parm1);
            end
        end
    end
end

---被动技能触发类型
---@return number 被动技能触发类型
function TalentSkillChangeLeaderBuffResult:GetType()
    return 17;
end

return TalentSkillChangeLeaderBuffResult;