---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zhaopuyang.
--- DateTime: 2022/8/24 11:41

require "Lib/class"

---@class TalentSkillAimToTargetTrigger : table
TalentSkillAimToTargetTrigger = class(nil, 'TalentSkillAimToTargetTrigger');

function TalentSkillAimToTargetTrigger:ctor(_battleId)
    ---@type number
    self.battleId = _battleId
    self.battleRoom = GetBattleRoom(self.battleId)
    self.trigger = false;
    self.targetNetId = 0;
    self.targetObjectId = 0;
    self.lastTriggerTime = TimeUtils.battleNow(self.battleId);
end

---@public
---切换目标
---@param _targetNetId number 伤害目标netId
function TalentSkillAimToTargetTrigger:OnChangeTarget(_targetNetId)
    self.targetNetId = _targetNetId;
    local _unit = self.battleRoom.battleUnitManager:GetUnit(_targetNetId, true);
    if _unit then
        self.targetObjectId = _unit:GetCurrentHeroObject():GetObjectId();
    end
    self.trigger = true;
end



---@public
---@param _battleObject BattleObjectBase 触发单位
---@param _talentSkillTrigger SkillTrigger 被动技能配置
---@param _talentSkill BattlePlayerTalentSkill 被动技能
function TalentSkillAimToTargetTrigger:Check(_battleObject, _talentSkillTrigger,_talentSkill)
    if TimeUtils.battleNow(self.battleId) - self.lastTriggerTime < _talentSkillTrigger.parm6 then
        return 0;
    end

    if self.trigger then
        if self.targetNetId ~= 0 and self.targetObjectId ~= 0 then
            _talentSkill:AddTriggerObject(self.targetObjectId,1);
        end
        self:Reset();
        return 1;
    end
    return 0;
end

---@public
function TalentSkillAimToTargetTrigger:Reset()
    self.targetNetId = nil;
    self.targetObjectId = nil;
    self.trigger = false;
end

---被动技能触发类型
---@return number 被动技能触发类型
function TalentSkillAimToTargetTrigger:GetType()
    return 124;
end

return TalentSkillAimToTargetTrigger;