---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by hejincheng.
--- DateTime: 2022/8/2 12:03

require "Lib/class"

---@class TagManager : table
TagManager = class(nil, 'TagManager');

TAG_ENUM = {
    -- 怪物进入关键区域
    ENTER_AREA_MONSTER = 1,
    -- 怪物波次
    MONSTER_WAVE = 2,
    -- 极奏加无敌计数(糊一下)
    JIZOU_ADDBUFF_NUM = 3,
}

function TagManager:ctor(_battleId)
    self.battleId = _battleId
    self.battleRoom = GetBattleRoom(self.battleId)
end

function TagManager:__Init()
    ---@type table<string,number>
    self.tagValueDic = {}
end

function TagManager:Init()
    self:__Init()
end

---@public
---@param _tag number TAG_ENUM枚举
---@param _value number tag值
function TagManager:UpdateTagValue(_tag, _value)
    if not _tag or not _value then
        return
    end
    local _oldValue = self.tagValueDic[tostring(_tag)]
    if _value ~= _oldValue then
        self.tagValueDic[tostring(_tag)] = _value
        self.battleRoom.battleLogicEventService:OnTriggerTagValueChangeEvent(_tag, _value)

        local msg = {}
        msg.tag = _tag
        msg.value = _value
        self.battleRoom.outputDataSource:ChangeTagS2C(msg)
    end
end

---@public
---@param _tag number TAG_ENUM枚举
---@return number tag值
function TagManager:GetTagValue(_tag)
    return self.tagValueDic[tostring(_tag)]
end

---@public
---@param _tag number
---@param _value number
function TagManager:ChangeTagS2C(_tag, _value)
    local msg = {}
    msg.tag = _tag
    msg.value = _value
    self.battleRoom.outputDataSource:ChangeTag_L2V(msg)
end

-- 退出清理
---@public
function TagManager:__OnUpdate(_deltaTime, _frameId)

end

---@public
---@param _deltaTime number
---@param _frameId number
function TagManager:OnUpdate(_deltaTime, _frameId)
    self:__OnUpdate(_deltaTime, _frameId)
end

-- 退出清理
---@public
function TagManager:__Clear()

end

-- 退出清理
---@public
function TagManager:Clear()
    self:__Clear()
end

return TagManager;