---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiangxuechen
--- DateTime: 2023/07/27 14:51
--- Describe:
---

---@class BattleUnitCom_RogueUnitSkill : BattleUnitComponentBase
BattleUnitCom_RogueUnitSkill = class(BattleUnitComponentBase, "BattleUnitCom_RogueUnitSkill")
function BattleUnitCom_RogueUnitSkill:ctor(_data)
	self:__ctor(BattleUnitComponentType.RogueUnitSkill)
end

---@public
---@param _battleUnit BattleUnitBase
---@param _battleCreateUnitParam BattleCreateUnitParam
function BattleUnitCom_RogueUnitSkill:Init(_battleUnit, _battleCreateUnitParam)
	self:__Init(_battleUnit)

	---当前是否已开启
	---@private
	---@type boolean
	self.__opened = false
	
	if _battleUnit:CheckUnitType(BattleUnitType.Player) then
		self:__InitPlayer(_battleCreateUnitParam)
	else
		
	end
	
end

---@public
function BattleUnitCom_RogueUnitSkill:Clear()
	self:__Clear()
end
------------------------------------------------------------------------------------------------------------------------

---@private
---@param _battleCreateUnitParam BattleCreateUnitParam
function BattleUnitCom_RogueUnitSkill:__InitPlayer(_battleCreateUnitParam)
	local _rogueUnitSkillInfo = _battleCreateUnitParam.battlePlayerInfo.rogueUnitSkillInfo
	if CheckLogLevel(LogLevel.log) and LogTools.RogueUnitSkillLog then
		LogTools.LogByLevel(LogLevel.log, "肉鸽主公技", "BattleUnitCom_RogueUnitSkill:__InitPlayer", "proto传进来的主公技数据", dumpTableEx(_rogueUnitSkillInfo))
	end
	--_rogueUnitSkillInfo = {
	--	--id = 101,
	--	--strengthSkillIds = {1010200, 1010201, 1010202, 1010205, 10103, 10104},
	--	id = 102,
	--	strengthSkillIds = {10202, 1020300, 10204},
	--	--id = 103,
	--	--strengthSkillIds = {10302, 10303, 10304},
	--	--id = 104,
	--	--strengthSkillIds = {10402, 10403, 10404},
	--	opened = false
	--}
	if not _rogueUnitSkillInfo then return end
	if not _rogueUnitSkillInfo.id or 0 == _rogueUnitSkillInfo.id then return end
	if not _rogueUnitSkillInfo.opened then
		_rogueUnitSkillInfo.opened = false
	end

	self.__rogueUnitSkillInfo = _rogueUnitSkillInfo
	
	---@type RogueUnitSkill
	local _rogueUnitSkillXls = self:GetBattleRoom().inputDataSource:GetDict("RogueUnitSkill", _rogueUnitSkillInfo.id)
	if not _rogueUnitSkillXls then
		if CheckLogLevel(LogLevel.log) and LogTools.RogueUnitSkillLog then
			LogTools.LogByLevel(LogLevel.logErr, "肉鸽主公技初始化错误！！！没有找到对应的RogueUnitSkill表数据！！！", "id", _rogueUnitSkillInfo.id)
		end
		return
	end

	---@type RogueUnitSkillData
	local _skillData = self:GetBattleRoom().rogueUnitSkillService:GenerateRogueUnitSkill()
	---@private
	self.__rogueUnitSkill = _skillData
	_skillData:Init(self:GetUnit(), _rogueUnitSkillXls, _rogueUnitSkillInfo.strengthSkillIds)
	self:Open(_rogueUnitSkillInfo.opened, true)
end

---@public
---@return RogueUnitSkillData
function BattleUnitCom_RogueUnitSkill:GetRogueUnitSkill()
	return self.__rogueUnitSkill
end

---@public
---@return table msg.RogueUnitSkillInfo
function BattleUnitCom_RogueUnitSkill:GetRogueUnitSkillInfo()
	return self.__rogueUnitSkillInfo
end

---检查是否可以施放肉鸽主公技
---@public
---@return boolean
function BattleUnitCom_RogueUnitSkill:CheckCanUseSkill()
	--已经开启了就不能再次施放了
	if self.__opened then return false end
	if not self.__rogueUnitSkill then return false end
	return self.__rogueUnitSkill:CheckEnEnough()
end

---@public
---@param _isInit boolean 是否是默认调用的开启，默认调用的开启不单独发消息
function BattleUnitCom_RogueUnitSkill:Open(_bool, _isInit)
	if CheckLogLevel(LogLevel.log) and LogTools.RogueUnitSkillLog then
		LogTools.LogByLevel(LogLevel.log, "肉鸽主公技", "BattleUnitCom_RogueUnitSkill:Open", "_bool", _bool, "_isInit", _isInit, "self.__rogueUnitSkill", self.__rogueUnitSkill, "self.__opened", self.__opened)
	end
	if not self.__rogueUnitSkill then return end
	if self.__opened == _bool then return end

	self.__opened = _bool
	if _bool then
		self:Update(0)
		self.__rogueUnitSkill:RemoveAllEnCollectors()
		self.__rogueUnitSkill:DumpCurActions()
	end

	if not _isInit then
		---肉鸽主公技不考虑多人
		local _RogueUnitSkillOpenedChange_L2V = {
			netId = self:GetUnit():GetNetId(),
			opened = _bool
		}
		self:GetBattleRoom().outputDataSource:RogueUnitSkillOpenedChange_L2V(_RogueUnitSkillOpenedChange_L2V)
	end
end

---@public
---@return boolean
function BattleUnitCom_RogueUnitSkill:GetOpened()
	return self.__opened
end

---@public
function BattleUnitCom_RogueUnitSkill:Update(_deltaTime)
	if not self.__rogueUnitSkill then return end
	if not self.__opened then return end
	self.__rogueUnitSkill:OnUpdate(_deltaTime)
end

return BattleUnitCom_RogueUnitSkill