---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zhaopuyang.
--- DateTime: 2021/12/16 11:03
--- 服务器输入数据接收器

require "Lib/class"
require "Battle/Logic/Room/Component/InputDataSource"

BATTLE_DICT = luajava.bindClass("com.biligame.access.dictdata.helper.BattleDict")

---@class ServerInputDataSource : InputDataSource 服务器输入数据接收器
ServerInputDataSource = class(InputDataSource,'ServerInputDataSource');

function ServerInputDataSource:ctor()

end

-- 初始化
---@public
---@param _clientUid number 启动logic_core的客户端id
function ServerInputDataSource:Init(_clientUid)
    self:__Init(_clientUid);
end

-- 接收协议接口
---@public
---@param _uid number 发送协议的玩家id，如果是战斗房间消息该值为nil
---@param _id number 协议id
---@param _msgTable table 协议
function ServerInputDataSource:OnReceiveMessage(_uid, _id, _msgTable)
    local battleRoomMessage = BattleRoomMessage:New();
    local proto = PROTO_CODE_MAP[tostring(_id)];
    if proto ~= nil then
        if proto:GetType() == "ROOM" then
            battleRoomMessage:Init(_uid,_id,_msgTable);
            table.insert(self.roomMessages,battleRoomMessage);
        else
            battleRoomMessage:Init(_uid,_id,_msgTable);
            table.insert(self.playerCommands,battleRoomMessage);
        end
    end
end

-- 读取dict
---@public
---@param _dictName string 表名
---@param _id number 表key
---@return table 表数据
function ServerInputDataSource:GetDict(_dictName, _id)
    return BATTLE_DICT:getLuaTableByNameAndId(_dictName, _id)
end

return ServerInputDataSource;