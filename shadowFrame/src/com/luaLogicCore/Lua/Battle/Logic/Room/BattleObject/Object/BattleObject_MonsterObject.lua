---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiangxuechen
--- DateTime: 2022/01/26 16:09
--- Describe: 怪物类object
---

---@class BattleObject_MonsterObject : BattleObjectBase
BattleObject_MonsterObject = class(BattleObjectBase, "BattleObject_MonsterObject")

---@public
---@param _createBattleUnitParam BattleCreateUnitParam
function BattleObject_MonsterObject:Init(_battleId, _objectId, _parentUnit, _createBattleUnitParam, _teamPos)
	--LogTools.LogByLevel(LogLevel.log, "BattleObject_MonsterObject", "Init", "_objectId", _objectId, "_dicId", _createBattleUnitParam.objIdList[1].dicId)
	self.__teamPos = _teamPos
	self:__Init(_battleId, _parentUnit, _objectId, _createBattleUnitParam.dicId)
	self:__InitComponents(_createBattleUnitParam)
end

function BattleObject_MonsterObject:__Clear()
	self:__Clear()
    self.__teamPos = nil
end

---@protected
---@param _createBattleUnitParam BattleCreateUnitParam
function BattleObject_MonsterObject:__InitComponents(_createBattleUnitParam)
	---@type BattleObjectComponentCreator
	local componentCreator = self:GetBattleRoom().battleObjectManager:GetObjectComponentCreator()
	
	---@type BattleObjCom_Config
	local _cfgCom = componentCreator:__CreateComponent(BattleObjectComponentType.Config)
	_cfgCom:Init(self)
	self:AddComponent(_cfgCom)

	---@type BattleObjCom_Property
	local _propCom = componentCreator:__CreateComponent(BattleObjectComponentType.Property)
	_propCom:Init(self, _cfgCom:GetDataInstanceXls(), _createBattleUnitParam, nil)
	self:AddComponent(_propCom)
	
	---@type BattleObjCom_LifeCtrl
    local _lifeCom = componentCreator:__CreateComponent(BattleObjectComponentType.LifeCtrl)
    _lifeCom:Init(self, _createBattleUnitParam)
    self:AddComponent(_lifeCom)
	
	---@type BattleObjCom_Block
	local _blockCom = componentCreator:__CreateComponent(BattleObjectComponentType.Block)
	_blockCom:Init(self)
	self:AddComponent(_blockCom)
	
	---@type BattleObjCom_Element_V2
	local _elementCom = componentCreator:__CreateComponent(BattleObjectComponentType.Element)
	_elementCom:Init(self)
	self:AddComponent(_elementCom)

	---@type BattleObjCom_Skill
	local _skillCom = componentCreator:__CreateComponent(BattleObjectComponentType.Skill)
	_skillCom:Init(self)
	self:AddComponent(_skillCom)

	---@type BattleObjCom_Buff
	local _buffCom = componentCreator:__CreateComponent(BattleObjectComponentType.Buff)
	_buffCom:Init(self)
	self:AddComponent(_buffCom)
	
	---@type BattleObjCom_HitValue
	local _hitValueCom = componentCreator:__CreateComponent(BattleObjectComponentType.HitValue)
	_hitValueCom:Init(self)
	self:AddComponent(_hitValueCom)

	---@type BattleObjCom_Drop
	local _dropCom = componentCreator:__CreateComponent(BattleObjectComponentType.Drop)
	---@type number
	local monsterFallId = _cfgCom:GetDataInstanceXls().monstertypeFallID
	local fallDictDataArr = self:GetBattleRoom().inputDataSource:getMonsterFallDataList(monsterFallId)
	_dropCom:Init(self, fallDictDataArr)
	self:AddComponent(_dropCom)

	-----@type BattleObjCom_Drop
	--local _colliderCom = componentCreator:__CreateComponent(BattleObjectComponentType.Collider)
	--_colliderCom:Init(self)
	--self:AddComponent(_colliderCom)

	---@type BattleObjCom_PlayMode
	local _aimModeCom = componentCreator:__CreateComponent(BattleObjectComponentType.PlayMode)
	_aimModeCom:Init(self)
	self:AddComponent(_aimModeCom)
end

---@public
function BattleObject_MonsterObject:GetTeamPos()
	return self.__teamPos
end

---获取单位的元素类型
---@public
---@return number
function BattleObject_MonsterObject:GetElementType()
	---@type MonsterInstance
	local monsterInstance = self:GetDataInstanceXls()
	return monsterInstance.monsterElement
end

------------------------------------------------------------------------------------------------------------------------
function BattleObject_MonsterObject:GetL2SMessageData()
	local _monsterObjectInfo_L2S = {}
    _monsterObjectInfo_L2S.objectId = self:GetObjectId()
	_monsterObjectInfo_L2S.alive = not self.__isDead
	---@type BattleObjCom_LifeCtrl
	local _lifeCom = self:GetComponent(BattleObjectComponentType.LifeCtrl)
	_monsterObjectInfo_L2S.createTime = _lifeCom:GetCreateTime()
	_monsterObjectInfo_L2S.dicId = self:GetDicId()
	---@type BattleObjCom_Config
	local _configCom = self:GetComponent(BattleObjectComponentType.Config)
	_monsterObjectInfo_L2S.templateId = _configCom:GetShowId()
	---@type BattleObjCom_Property
	local _propCom = self:GetComponent(BattleObjectComponentType.Property)
	_monsterObjectInfo_L2S.property = _propCom:GetProtoHash()
	_monsterObjectInfo_L2S.curStage = _propCom:GetCurStage()
	_monsterObjectInfo_L2S.eleWeakTypeList = _propCom:GetEleWeakTypeList()
	---@type BattleObjCom_PlayMode
	local _aimModeCom = self:GetComponent(BattleObjectComponentType.PlayMode)
	_monsterObjectInfo_L2S.aimMode = _aimModeCom.aimMode
	_monsterObjectInfo_L2S.blockInfoList = self:__CollectBlockDataList()
	--LogTools.LogByLevel(LogLevel.log, "blockInfoList", dumpTableEx(_monsterObjectInfo_L2S.blockInfoList))
	return _monsterObjectInfo_L2S
end

return BattleObject_MonsterObject