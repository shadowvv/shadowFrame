---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiangxuechen
--- DateTime: 2022/07/23 14:41
--- Describe: 场景物件object
---

---@class BattleObject_SceneObj : BattleObjectBase
BattleObject_SceneObj = class(BattleObjectBase, "BattleObject_SceneObj")

---@public
---@param _parentUnit BattleUnitBase
---@param _createBattleUnitParam BattleCreateUnitParam
function BattleObject_SceneObj:Init(_battleId, _objectId, _parentUnit, _createBattleUnitParam)
	--LogTools.LogByLevel(LogLevel.log, "BattleObject_SceneObj", "Init", "_objectId", _objectId, "_dicId", _dicId)
	self:__Init(_battleId, _parentUnit, _objectId, _createBattleUnitParam.dicId)
	self:__InitComponents(_createBattleUnitParam)
end

---@protected
---@param _createBattleUnitParam BattleCreateUnitParam
function BattleObject_SceneObj:__InitComponents(_createBattleUnitParam)
	---@type BattleObjectComponentCreator
	local componentCreator = self:GetBattleRoom().battleObjectManager:GetObjectComponentCreator()
	
	---@type BattleObjCom_Config
	local _cfgCom = componentCreator:__CreateComponent(BattleObjectComponentType.Config)
	_cfgCom:Init(self)
	self:AddComponent(_cfgCom)

	---@type BattleObjCom_Property
	local _propCom = componentCreator:__CreateComponent(BattleObjectComponentType.Property)
	_propCom:Init(self, _cfgCom:GetDataInstanceXls())
	self:AddComponent(_propCom)
	
	---@type BattleObjCom_LifeCtrl
    local _lifeCom = componentCreator:__CreateComponent(BattleObjectComponentType.LifeCtrl)
    _lifeCom:Init(self, _createBattleUnitParam)
    self:AddComponent(_lifeCom)
	
	---@type BattleObjCom_BoundaryListener
	local _boundaryListener = componentCreator:__CreateComponent(BattleObjectComponentType.BoundaryListener)
	_boundaryListener:Init(self, _createBattleUnitParam)
	self:AddComponent(_boundaryListener)
	
	---@type BattleObjCom_BoundaryTrigger
	local _boundaryTrigger = componentCreator:__CreateComponent(BattleObjectComponentType.BoundaryTrigger)
	_boundaryTrigger:Init(self, _createBattleUnitParam)
	self:AddComponent(_boundaryTrigger)
	
	---@type BattleObjCom_Block
	local _blockCom = componentCreator:__CreateComponent(BattleObjectComponentType.Block)
	_blockCom:Init(self)
	self:AddComponent(_blockCom)

	-----@type BattleObjCom_Element_V2
	--local _elementCom = componentCreator:__CreateComponent(BattleObjectComponentType.Element)
	--_elementCom:Init(self)
	--self:AddComponent(_elementCom)

	-----@type BattleObjCom_Skill
	--local _skillCom = componentCreator:__CreateComponent(BattleObjectComponentType.Skill)
	--_skillCom:Init(self)
	--self:AddComponent(_skillCom)

	-----@type BattleObjCom_Buff
	--local _buffCom = componentCreator:__CreateComponent(BattleObjectComponentType.Buff)
	--_buffCom:Init(self)
	--self:AddComponent(_buffCom)
	
	-----@type BattleObjCom_HitValue
	--local _hitValueCom = componentCreator:__CreateComponent(BattleObjectComponentType.HitValue)
	--_hitValueCom:Init(self)
	--self:AddComponent(_hitValueCom)
	--
	---@type BattleObjCom_Drop
	local _dropCom = componentCreator:__CreateComponent(BattleObjectComponentType.Drop)
	_dropCom:Init(self)
	self:AddComponent(_dropCom)
end

------------------------------------------------------------------------------------------------------------------------
function BattleObject_SceneObj:GetL2SMessageData()
	local _SceneObjObjectInfo_L2V = {}
    _SceneObjObjectInfo_L2V.objectId = self:GetObjectId()
	_SceneObjObjectInfo_L2V.alive = not self.__isDead
	---@type BattleObjCom_LifeCtrl
	local _lifeCom = self:GetComponent(BattleObjectComponentType.LifeCtrl)
	_SceneObjObjectInfo_L2V.createTime = _lifeCom:GetCreateTime()
	_SceneObjObjectInfo_L2V.dicId = self:GetDicId()
	---@type BattleObjCom_Property
	local _propCom = self:GetComponent(BattleObjectComponentType.Property)
	_SceneObjObjectInfo_L2V.property = _propCom:GetProtoHash()
	_SceneObjObjectInfo_L2V.curStage = _propCom:GetCurStage()
	_SceneObjObjectInfo_L2V.eleWeakTypeList = _propCom:GetEleWeakTypeList()
	---@type BattleUnitCom_TagSelector
	local _tagCom = self:GetParentUnit():GetComponent(BattleUnitComponentType.TagSelector)
	_SceneObjObjectInfo_L2V.initState = _tagCom:GetTag(BattleUnitTagEnum.SceneObjState)
	_SceneObjObjectInfo_L2V.blockInfoList = self:__CollectBlockDataList()
	return _SceneObjObjectInfo_L2V
end

return BattleObject_SceneObj