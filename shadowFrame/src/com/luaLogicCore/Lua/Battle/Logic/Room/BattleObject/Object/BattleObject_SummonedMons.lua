---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiangxuechen
--- DateTime: 2022/07/12 16:53
--- Describe: 召唤物OBJ
---

---@class BattleObject_SummonedMons : BattleObjectBase
BattleObject_SummonedMons = class(BattleObjectBase, "BattleObject_SummonedMons")

---@public
---@param _parentUnit BattleUnitBase
---@param _createBattleUnitParam BattleCreateUnitParam
function BattleObject_SummonedMons:Init(_battleId, _objectId, _parentUnit, _createBattleUnitParam)
    ----LogTools.LogByLevel(LogLevel.log, "BattleObject_SummonedMons", "Init")
	self:__Init(_battleId, _parentUnit, _objectId, _createBattleUnitParam.dicId)
    self:__InitComponents(_createBattleUnitParam)
end

---@protected
---@param _createBattleUnitParam BattleCreateUnitParam
function BattleObject_SummonedMons:__InitComponents(_createBattleUnitParam)
    ---@type BattleObjectComponentCreator
	local componentCreator = self:GetBattleRoom().battleObjectManager:GetObjectComponentCreator()
	
    ---@type BattleObjCom_Config
	local _cfgCom = componentCreator:__CreateComponent(BattleObjectComponentType.Config)
	_cfgCom:Init(self)
    self:AddComponent(_cfgCom)

    ---@type BattleObjCom_Property
	local _propCom = componentCreator:__CreateComponent(BattleObjectComponentType.Property)
	_propCom:Init(self, _cfgCom:GetInstanceXls(), _createBattleUnitParam)  --召唤物的属性暂时需要先读召唤物自身的Instance表
    self:AddComponent(_propCom)
	
	---@type BattleObjCom_LifeCtrl
    local _lifeCom = componentCreator:__CreateComponent(BattleObjectComponentType.LifeCtrl)
    _lifeCom:Init(self, _createBattleUnitParam)
    self:AddComponent(_lifeCom)
	
	---@type BattleObjCom_Block
	local _blockCom = componentCreator:__CreateComponent(BattleObjectComponentType.Block)
	_blockCom:Init(self)
	self:AddComponent(_blockCom)

    ---@type BattleObjCom_Element_V2
    local _elementCom = componentCreator:__CreateComponent(BattleObjectComponentType.Element)
    _elementCom:Init(self)
    self:AddComponent(_elementCom)
	
	---@type BattleObjCom_Skill
	local _skillCom = componentCreator:__CreateComponent(BattleObjectComponentType.Skill)
	_skillCom:Init(self)
	self:AddComponent(_skillCom)
	
    ---@type BattleObjCom_Buff
    local _buffCom = componentCreator:__CreateComponent(BattleObjectComponentType.Buff)
    _buffCom:Init(self)
    self:AddComponent(_buffCom)
	
    ---@type BattleObjCom_HitValue
    local _hitValueCom = componentCreator:__CreateComponent(BattleObjectComponentType.HitValue)
    _hitValueCom:Init(self)
    self:AddComponent(_hitValueCom)
	
    ---@type BattleObjCom_Drop
    local _dropCom = componentCreator:__CreateComponent(BattleObjectComponentType.Drop)
	---@type number
	local _monsterFallId = _cfgCom:GetDataInstanceXls().monstertypeFallID
	local _fallDictDataArr = self:GetBattleRoom().inputDataSource:getMonsterFallDataList(_monsterFallId)
    _dropCom:Init(self, _fallDictDataArr)
    self:AddComponent(_dropCom)
	
end

---@public
---检查是否可以被击中
function BattleObject_SummonedMons:CheckCanBeHitted()
	---@type BattleObjCom_Config
   local _cfgCom = self:GetComponent(BattleObjectComponentType.Config)
	---@type SummonedMonster
	local _summondMons = _cfgCom:GetInstanceXls()
	return 1 == _summondMons.isHit
end

---@public
---检查是否走伤害公式（命中是否受伤）
function BattleObject_SummonedMons:CheckCalculateHurt()
    ---@type BattleObjCom_Config
   local _cfgCom = self:GetComponent(BattleObjectComponentType.Config)
	---@type SummonedMonster
	local _summondMons = _cfgCom:GetInstanceXls()
	return 1 == _summondMons.isCalculated
end

---@public
---检查是否可以被瞄准
function BattleObject_SummonedMons:CheckCanBeAimed()
    ---@type BattleObjCom_Config
   local _cfgCom = self:GetComponent(BattleObjectComponentType.Config)
	---@type SummonedMonster
	local _summondMons = _cfgCom:GetInstanceXls()
	return 1 == _summondMons.isAimed
end

---@public
---检查是否可以被牵引
function BattleObject_SummonedMons:CheckCanBeDraged()
    ---@type BattleObjCom_Config
   local _cfgCom = self:GetComponent(BattleObjectComponentType.Config)
	---@type SummonedMonster
	local _summondMons = _cfgCom:GetInstanceXls()
	return 1 == _summondMons.isDraged
end

---死亡时从召唤者的记录中移除自身
---@public
function BattleObject_SummonedMons:SetDead()
	if LogTools.SummondLog and CheckLogLevel(LogLevel.log) then
		LogTools.LogByLevel(LogLevel.log, "CheckSummonedMons", "BattleObject_SummonedMons:SetDead", "netId", self:GetParentUnit():GetNetId(), "objId", self:GetObjectId(), "dicId", self:GetDicId(), "Frame", self:GetBattleRoom().frameId)
	end
	---@type BattleUnitCom_Subordination
	local _subordinateCom = self:GetParentUnit():GetComponent(BattleUnitComponentType.Subordination)
	---@type BattleUnitCom_Subordination
	local _parentSUbordinateCom = _subordinateCom:GetSubordinatedUnitComponent(BattleUnitComponentType.Subordination)
	if _parentSUbordinateCom then
		if LogTools.SummondLog and CheckLogLevel(LogLevel.log) then
			LogTools.LogByLevel(LogLevel.log, "CheckSummonedMons", "BattleObject_SummonedMons:SetDead", "_parentSUbordinateCom:RemoveManagedObjByObjId", "netId", self:GetParentUnit():GetNetId(), "objId", self:GetObjectId(), "dicId", self:GetDicId(), "Frame", self:GetBattleRoom().frameId)
		end
		_parentSUbordinateCom:RemoveManagedObjByObjId(self:GetDicId(), self:GetObjectId(), self:GetObjectType())
	end
	
	self:__SetDead()
end
------------------------------------------------------------------------------------------------------------------------
function BattleObject_SummonedMons:GetL2SMessageData()
	local _summondMonsObjectInfo_L2V = {}
    _summondMonsObjectInfo_L2V.objectId = self:GetObjectId()
	_summondMonsObjectInfo_L2V.alive = not self.__isDead
	---@type BattleObjCom_LifeCtrl
	local _lifeCom = self:GetComponent(BattleObjectComponentType.LifeCtrl)
	_summondMonsObjectInfo_L2V.createTime = _lifeCom:GetCreateTime()
	---@type BattleObjCom_Config
	local _cfgCom = self:GetComponent(BattleObjectComponentType.Config)
	---@type MonsterInstance
	local _monsterInstanceXls = _cfgCom:GetDataInstanceXls()
	_summondMonsObjectInfo_L2V.dicId = _monsterInstanceXls.id
	_summondMonsObjectInfo_L2V.templateId = _monsterInstanceXls.templateId
	---@type BattleObjCom_Property
	local _propCom = self:GetComponent(BattleObjectComponentType.Property)
	_summondMonsObjectInfo_L2V.property = _propCom:GetProtoHash()
	_summondMonsObjectInfo_L2V.curStage = _propCom:GetCurStage()
	_summondMonsObjectInfo_L2V.eleWeakTypeList = _propCom:GetEleWeakTypeList()
	_summondMonsObjectInfo_L2V.blockInfoList = self:__CollectBlockDataList()
	return _summondMonsObjectInfo_L2V
end

return BattleObject_SummonedMons