---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by hejincheng.
--- DateTime: 2023/6/19 17:49
---
require "Lib/class"

---@class ElementSource_Skill : ElementSource
---@field id number
ElementSource_Skill = class(ElementSource, 'ElementSource_Skill');

function ElementSource_Skill:ctor(_id)
    self.id = _id;
end

---元素积累加成
---@public
---@param _sourceObject BattleObjectBase
---@param _targetObject BattleObjectBase
---@param _elementId number
---@param _elementValue number
---@param _elementSourceId number
---@return number
function ElementSource_Skill:AddElementAccValue(_sourceObject, _targetObject, _elementId, _elementValue, _elementSourceId)
    if not _elementSourceId then
        return _elementValue
    end
    ---@type BattleObjCom_Property
    local _comProp = _sourceObject:GetComponent(BattleObjectComponentType.Property)
    ---@type Skill
    local _skill = _sourceObject:GetBattleRoom().inputDataSource:GetDict("Skill", _elementSourceId)
    if not _skill then
        -- 线上报200801301找不到，策划说没问题，那就注了
        --if LogTools.ElementLog and CheckLogLevel(LogLevel.log) then
        --    LogTools.LogByLevel(LogLevel.log, "ElementSource_Skill", "AddElementAccValue", "failed", "skill nil",
        --            "sourceNetId", _sourceObject:GetParentUnit():GetNetId(),
        --            "targetNetId", _targetObject:GetParentUnit():GetNetId(), "elementId", _elementId,
        --            "elementValue", _elementValue, "elementSourceId", _elementSourceId)
        --end
        return
    end
    local _elementAccSpdAdd = 0
    if _skill.skillType == SkillTypeEnum.NORMAL:GetId() then
        _elementAccSpdAdd = _comProp:GetPropertyByName(BattlePropertyEnum.ElementAccSpdAdd_NormalSkill) or 0
    elseif _skill.skillType == SkillTypeEnum.ACTIVE:GetId() then
        _elementAccSpdAdd = _comProp:GetPropertyByName(BattlePropertyEnum.ElementAccSpdAdd_ActiveSkill) or 0
    elseif _skill.skillType == SkillTypeEnum.JI_ZOU:GetId() then
        _elementAccSpdAdd = _comProp:GetPropertyByName(BattlePropertyEnum.ElementAccSpdAdd_JizouSkill) or 0
    end
    local _finalValue = _elementValue * (1 + _elementAccSpdAdd)
    self:__PrintAddElementLog(_sourceObject, _targetObject, _elementId, _elementValue, _elementSourceId, _elementAccSpdAdd, _finalValue)
    return _finalValue
end

return ElementSource_Skill;