---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiangxuechen
--- DateTime: 2022/07/05 14:58
--- Describe: 战场区域
---

---@class BattleObjCom_AreaTrigger : BattleObjectComponentBase
BattleObjCom_AreaTrigger = class(BattleObjectComponentBase, "BattleObjCom_AreaTrigger")
function BattleObjCom_AreaTrigger:ctor()
	self:__ctor(BattleObjectComponentType.AreaTrigger)
end

---@public
---@param _battleObject BattleObjectBase
---@param _battleCreateUnitParam BattleCreateUnitParam
function BattleObjCom_AreaTrigger:Init(_battleObject, _battleCreateUnitParam)
	self:__Init(_battleObject)
	self:__InitCreateTriggerParam(_battleCreateUnitParam)
end

---@private
---@param _battleCreateUnitParam BattleCreateUnitParam
function BattleObjCom_AreaTrigger:__InitCreateTriggerParam(_battleCreateUnitParam)
	--LogTools.LogByLevel(LogLevel.log, "CheckArea", "BattleObjCom_AreaTrigger __InitCreateTriggerParam _battleCreateUnitParam", dumpTableEx(_battleCreateUnitParam))
	self.__snapShotIndex = _battleCreateUnitParam.snapShotIndex
	self.__subordinatedNetId = _battleCreateUnitParam.subordinatedNetId
	self.__subordinatedObjId = _battleCreateUnitParam.subordinatedObjId
	self.__sourceType = _battleCreateUnitParam.sourceType
	self.__sourceId = _battleCreateUnitParam.sourceId
	self.__skillNodeId = _battleCreateUnitParam.skillNodeId
	self.__registBuffTempList = _battleCreateUnitParam.buffTempList or {}
	self.__createPos = _battleCreateUnitParam.position
	self.__createRot = _battleCreateUnitParam.rotation
	self.__createScale = _battleCreateUnitParam.scale
	self.__createVelocity = _battleCreateUnitParam.velocity
	self.__generateStackInfo = _battleCreateUnitParam.generateStackInfo
	self.__specificStackNum = _battleCreateUnitParam.specificStackNum
end

------------------------------------------------------------------------------------------------------------------------
---@public
function BattleObjCom_AreaTrigger:OnUpdate(_deltaTime)
end

---发消息通知创建(这里废弃了，走unit统一的创建消息)
---@public
function BattleObjCom_AreaTrigger:OnCreate()
end

---发消息通知开启
---@public
function BattleObjCom_AreaTrigger:OnOpen()
	if LogTools.AreaLog and CheckLogLevel(LogLevel.log) then
		LogTools.LogByLevel(LogLevel.log, "CheckArea", "BattleObjCom_AreaTrigger OnOpen start")
	end
	---@type BattleObjectBase
	local _triggerObj = self:GetObject()
	
	local _BattleFieldData = {}
	_BattleFieldData.areaTrigInfo = {}
	_BattleFieldData.areaTrigInfo.OpenAreaTrigIndex = _triggerObj:GetParentUnit():GetNetId()
	_BattleFieldData.areaTrigInfo.CloseAreaTrigIndex = -1
	_BattleFieldData.areaTrigInfo.DestroyAreaTrigIndex = -1

	self.battleRoom.outputDataSource:AddBattleFieldData(_BattleFieldData)
	if LogTools.AreaLog and CheckLogLevel(LogLevel.log) then
		LogTools.LogByLevel(LogLevel.log, "CheckArea", "BattleObjCom_AreaTrigger OnOpen end", "_BattleFieldData", dumpTableEx(_BattleFieldData))
	end
end

---结束发消息通知关闭
---暂时先不用，走销毁，有需求在单独通知关闭
---@public
function BattleObjCom_AreaTrigger:OnClose()
	---@type BattleObjectBase
	local _triggerObj = self:GetObject()
	if LogTools.AreaLog and CheckLogLevel(LogLevel.log) then
		LogTools.LogByLevel(LogLevel.log, "CheckArea", "BattleObjCom_AreaTrigger OnClose start", _triggerObj:GetParentUnit():GetNetId())
	end
	
	local _BattleFieldData = {}
	_BattleFieldData.areaTrigInfo = {}
	_BattleFieldData.areaTrigInfo.OpenAreaTrigIndex = -1
	_BattleFieldData.areaTrigInfo.CloseAreaTrigIndex = _triggerObj:GetParentUnit():GetNetId()
	_BattleFieldData.areaTrigInfo.DestroyAreaTrigIndex = -1

	self.battleRoom.outputDataSource:AddBattleFieldData(_BattleFieldData)
	if LogTools.AreaLog and CheckLogLevel(LogLevel.log) then
		LogTools.LogByLevel(LogLevel.log, "CheckArea", "BattleObjCom_AreaTrigger OnClose end", "_BattleFieldData", dumpTableEx(_BattleFieldData))
	end
end

---发消息通知销毁
---@public
function BattleObjCom_AreaTrigger:OnDestroy()
	
	---@type BattleObjectBase
	local _triggerObj = self:GetObject()
	if LogTools.AreaLog and CheckLogLevel(LogLevel.log) then
		LogTools.LogByLevel(LogLevel.log, "CheckArea", "BattleObjCom_AreaTrigger OnDestroy start", _triggerObj:GetParentUnit():GetNetId())
	end
	
	local _BattleFieldData = {}
	_BattleFieldData.areaTrigInfo = {}
	_BattleFieldData.areaTrigInfo.OpenAreaTrigIndex = -1
	_BattleFieldData.areaTrigInfo.CloseAreaTrigIndex = -1
	_BattleFieldData.areaTrigInfo.DestroyAreaTrigIndex = _triggerObj:GetParentUnit():GetNetId()

	self.battleRoom.outputDataSource:AddBattleFieldData(_BattleFieldData)
	if LogTools.AreaLog and CheckLogLevel(LogLevel.log) then
		LogTools.LogByLevel(LogLevel.log, "CheckArea", "BattleObjCom_AreaTrigger OnDestroy end", "_BattleFieldData", dumpTableEx(_BattleFieldData))
	end
end

------------------------------------------------------------------------------------------------------------------------

---@public
---@return BattleObjectBase
function BattleObjCom_AreaTrigger:GetCastObj()
	return self:GetBattleRoom().battleObjectManager:GetObject(self.__subordinatedObjId)
end

---@public
---@return BattleBuffCastTemplate[]
function BattleObjCom_AreaTrigger:GetRegistBuffTempList()
	return self.__registBuffTempList
end

---@public
function BattleObjCom_AreaTrigger:CheckFromNetIdAndDicId(_fromNetId, _dicId)
	--LogTools.LogByLevel( LogLevel.log, "CheckArea", "BattleObjCom_AreaTrigger", "CheckFromNetIdAndDicId", "_fromNetId", _fromNetId, "_dicId", _dicId, "self.__snapShotData:GetNetId()", self.__snapShotData:GetNetId(), "self:GetObject():GetDicId()", self:GetObject():GetDicId())
	return self.__subordinatedNetId == _fromNetId and self:GetObject():GetDicId() == _dicId
end

---@public
function BattleObjCom_AreaTrigger:GetGenerateStackInfo()
	if not self.__generateStackInfo then
		self.__generateStackInfo = {
			hurtParamFix = 1,
			specifiedReacId = 0,
			specifiedEleBreakId = 0,
			originalHurt = 0
		}
	end
	return self.__generateStackInfo
end

---@public
---@return number
function BattleObjCom_AreaTrigger:GetSpecificStackNum()
	return self.__specificStackNum
end

---@public
--function BattleObjCom_AreaTrigger:GetHurtParamFix()
--	return self.__hurtParamFix or 1
--end

---@public
function BattleObjCom_AreaTrigger:Clear()
	self.__sourceType = nil
	self.__sourceId = nil
	self.__skillNodeId = nil
	self.__createPos = nil
	self.__createRot = nil
	self.__createScale = nil
	self.__createVelocity = nil
	self.__registBuffTempList = nil
	self.__hurtParamFix = nil
	self.__specifiedReacId = nil
	self.__specifiedEleBreakId = nil
	self.__specificStackNum = nil
	
	self:__Clear()
end

return BattleObjCom_AreaTrigger