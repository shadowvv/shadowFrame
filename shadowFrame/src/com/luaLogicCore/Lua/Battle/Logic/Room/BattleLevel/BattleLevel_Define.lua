---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiangxuechen
--- DateTime: 2022/01/13 11:05
--- Describe:
---

---@class BattleLevel_Define : table
BattleLevel_Define = {}
BattleLevel_Define.LogLevel = LogLevel.log

BattleLevel_Define_StageEnum = {
    None = 0, --无，初始默认阶段
    Loading = 1, --加载阶段
    PreBattlePlot = 2, --战前剧情阶段
    ShowBattleStart = 3, --战斗开始阶段
    RunBattle = 4, --战斗过程阶段
    ShowBattleEnd = 5, --战斗结束阶段
    PreSettlePlot = 6, --结算前剧情阶段
    ShowBattleSettle = 7, --结算阶段
    AfterSettlePlot = 8, --结算后剧情阶段
    BattleUnloaded = 9, --战斗已结束
}
--
local stageCanEnterDefine = {
    [BattleLevel_Define_StageEnum.Loading] = {
        BattleLevel_Define_StageEnum.None,
    },
    [BattleLevel_Define_StageEnum.PreBattlePlot] = {
        BattleLevel_Define_StageEnum.Loading
    },
    [BattleLevel_Define_StageEnum.ShowBattleStart] = {
        BattleLevel_Define_StageEnum.PreBattlePlot
    },
    [BattleLevel_Define_StageEnum.RunBattle] = {
        BattleLevel_Define_StageEnum.ShowBattleStart
    },
    [BattleLevel_Define_StageEnum.ShowBattleEnd] = {
        BattleLevel_Define_StageEnum.RunBattle
    },
}

function BattleLevel_Define_StageEnum.CanEnter(_fromStage, _toStage)
    local _canEnterToStageArr = stageCanEnterDefine[_toStage]
    if not _canEnterToStageArr then
        -- 没有定义可进入状态，就认为能进
        return true
    end
    return table.arrayContains(_canEnterToStageArr, _fromStage)
end

function BattleLevel_Define_StageEnum.Max()
    return BattleLevel_Define_StageEnum.BattleUnloaded
end

local stageTimeOutDic = {
    [BattleLevel_Define_StageEnum.None] = "levelInitTimeout",
    [BattleLevel_Define_StageEnum.Loading] = "loadingTimeout",
    [BattleLevel_Define_StageEnum.PreBattlePlot] = "preBattlePlotTimeout",
    [BattleLevel_Define_StageEnum.ShowBattleStart] = "battleStartTimeout",
    [BattleLevel_Define_StageEnum.RunBattle] = "inBattleTimeout",
    [BattleLevel_Define_StageEnum.PreSettlePlot] = "preSummaryPlotTimeout",
    [BattleLevel_Define_StageEnum.ShowBattleSettle] = "SummaryTimeout",
    [BattleLevel_Define_StageEnum.AfterSettlePlot] = "postSummaryPlotTimeout",
}

---@type function
---@param _battleRoom BattleRoom
---@param _stageEnum number
---@return number 阶段超时时间(ms)
function BattleLevel_Define_StageEnum.TimeOut(_battleRoom, _stageEnum)
    if IsClient() then
        return 0
    end
    ---@type string
    local _type = stageTimeOutDic[_stageEnum]
    if not _type then
        return 0
    end
    ---@type LevelConstant
    local _levelConstant = _battleRoom.inputDataSource:getLevelConstantByType(_type)
    if not _levelConstant then
        return 0
    end
    return _levelConstant.value1 * 1000
end
