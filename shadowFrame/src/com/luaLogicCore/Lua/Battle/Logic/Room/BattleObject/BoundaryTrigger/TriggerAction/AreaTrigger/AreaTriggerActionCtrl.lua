---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiangxuechen
--- DateTime: 2022/04/08 14:29
--- Describe: 触发效果管理
---

require "Battle/Logic/Room/BattleObject/BoundaryTrigger/TriggerAction/AreaTrigger/AreaTriggerActionData"

---触发效果类型
---@class AreaTriggerActionType : table
AreaTriggerActionType = {
	AddBuff = 1,     ---添加BUFF
	RemoveBuff = 2,  ---移除BUFF
}

---@class AreaTriggerActionCtrl : BoundaryTriggerActionCtrlBase
AreaTriggerActionCtrl = class(BoundaryTriggerActionCtrlBase, "AreaTriggerActionCtrl")

---@param _triggerCom BattleObjCom_BoundaryTrigger
---@param _areaColliderInstance AreaColliderInstance
function AreaTriggerActionCtrl:Init(_triggerCom, _areaColliderInstance)
	self:__Init(_triggerCom)
	
	---@type BattleObjCom_AreaTrigger
	local _areaCom = _triggerCom:GetObject():GetComponent(BattleObjectComponentType.AreaTrigger)
	local _regisBuffTemplateList = _areaCom:GetRegistBuffTempList()
	local _castObj = _areaCom:GetCastObj()
	---@type AreaTriggerActionData[]
	self.__enterActions_1 = _castObj and self:__InitTrigActions(_areaColliderInstance.enterAction, 0, 1, _castObj, _regisBuffTemplateList, _areaCom) or {}
	---@type AreaTriggerActionData[]
	self.__enterActions_2 = _castObj and self:__InitTrigActions(_areaColliderInstance.enterAction2, 0, 1, _castObj, _regisBuffTemplateList, _areaCom) or {}
	---@type AreaTriggerActionData[]
	self.__stayActions = _castObj and self:__InitTrigActions(_areaColliderInstance.stayAction, _areaColliderInstance.stayActionDelta, _areaColliderInstance.stayActionTimes, _castObj, _regisBuffTemplateList, _areaCom) or {}
	---@type AreaTriggerActionData[]
	self.__leaveActions_1 = _castObj and self:__InitTrigActions(_areaColliderInstance.leaveAction, 0, 1, _castObj, _regisBuffTemplateList, _areaCom) or {}
	---@type AreaTriggerActionData[]
	self.__leaveActions_2 = _castObj and self:__InitTrigActions(_areaColliderInstance.leaveAction2, 0, 1, _castObj, _regisBuffTemplateList, _areaCom) or {}
end

---@private
---@param _trigActionIdList table
---@param _areaCom BattleObjCom_AreaTrigger
function AreaTriggerActionCtrl:__InitTrigActions(_trigActionIdList, _actionDelta, _actionMaxTimes, _castObj, _regisBuffTemplateList, _areaCom)
	local _actionList = {}
	local _generateStackInfo = _areaCom:GetGenerateStackInfo()
	local _specificStackNum = _areaCom:GetSpecificStackNum()
	
	for i = 1, #_trigActionIdList do
		---@type AreaTriggerActionData
		local _action = AreaTriggerActionData.New()
		_action:Init(self.__triggerCom:GetBattleId(), self, _trigActionIdList[i], _actionDelta, _actionMaxTimes, _castObj, _regisBuffTemplateList, _generateStackInfo, _specificStackNum)
		table.insert(_actionList, _action)
	end

	return _actionList
end

return AreaTriggerActionCtrl