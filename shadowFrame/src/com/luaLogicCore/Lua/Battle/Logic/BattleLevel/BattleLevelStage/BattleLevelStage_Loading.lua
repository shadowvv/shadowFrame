---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiangxuechen
--- DateTime: 2022/01/13 10:57
--- Describe: 加载阶段
---

---@class BattleLevelStage_Loading : table
BattleLevelStage_Loading = class(BattleLevelStageBase, "BattleLevelStage_Loading")

-- 
function BattleLevelStage_Loading:OnEnter()
	LogTools.LogByLevel(BattleLevel_Define.LogLevel, "BattleLevel", "BattleLevelStage_Loading", "OnEnter")
	self:__OnEnter()

	self:OnStageEnd()
	--if IsServer() then
	--	--这部分是不是放到room层处理，只主动调用结束就可以了
	--	local _playerIds = BattleRoom.playerTable
	--	local _tab = {}
	--	local _cnt = 0
	--	for _playerId, _value in pairs(_playerIds) do
	--		_tab[_playerId] = 0
	--		_cnt = _cnt + 1
	--	end
	--	self.tagTab = _tab
	--	self.tagCnt = _cnt
	--else
	--	--通知表现层开始loading
	--	
	--end
end

-- 接收到表现层玩家loading结束的回调
function BattleLevelStage_Loading:OnRendModuleLoadingEnd(_playerId)
	if not _playerId then return end
	local _tagTab = self.tagTab
	if not _tagTab then return end
	if _tagTab[_playerId] ~= 0 then return end

	_tagTab[_playerId] = 1
	self.tagCnt = self.tagCnt - 1
	if self.tagCnt > 0 then return end
	
	self:OnStageEnd()
end

-- 
function BattleLevelStage_Loading:Clear()
	self.tagCnt = nil
	self.tagTab = nil
	self:__Clear()
end

return BattleLevelStage_Loading