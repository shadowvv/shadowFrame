---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zhaopuyang.
--- DateTime: 2023/3/21 16:31

require "Lib/class"
require "Battle/Logic/Skill/SkillBaseNode"

---@class  SkillMoveNode : SkillBaseNode
---@field nodeId number 节点id
---@field nextNodes SkillNodeExitData[] 子节点
SkillMoveNode = class(SkillBaseNode, ' SkillMoveNode');

---@param _nodeId number 节点id
---@param _once boolean 只执行一次
---@param _nextNodes SkillNodeExitData[] 子节点
---@param _specialExit SkillNodeExitData[] 特殊出口
function SkillMoveNode:ctor(_nodeId, _once, _nextNodes, _specialExit)
    self.nodeId = _nodeId;
    self.once = _once;
    self.nextNodes = _nextNodes;
    self.specialExit = _specialExit;
end

---执行技能节点
---@param _actionStateManager ActionStateManage 行为管理器
---@param _dt number 更新时间
---@param _netId number 单位id
---@param _skillModel SkillModel 技能配置
---@return boolean,table 是否执行结束,执行行为输出数据
function SkillMoveNode:DoAction(_actionStateManager, _dt, _netId, _skillModel)
    local currentMoveState = _actionStateManager:GetCurrentMoveState();
    if not currentMoveState then
        if _actionStateManager:TryEnter(MoveActionState:GetId(),nil,SkillActionState:GetId()) then
            ---@type MoveActionState
            local moveState = MoveActionState.New(_actionStateManager.battleId,_actionStateManager.battleUnit:GetStateParamId(),_actionStateManager.battleUnit:GetUnitType());
            moveState:Init(Vector3.New(0,1,0));
            if _actionStateManager:Enter(moveState) then
                _actionStateManager.currentStates[moveState:GetId()] = moveState;
            end
        end
    end
    return false, nil;
end

---始终检测节点结束
function SkillMoveNode:AlwaysCheckOver()
    return true;
end

---退出节点
---@public
---@param _actionStateManager ActionStateManage 行为管理器
function SkillMoveNode:ExitNode(_actionStateManager)
    local moveState = _actionStateManager:GetCurrentMoveState();
    if moveState then
        _actionStateManager:Exit(moveState,false,true,false);
    end
end

---返回节点类型
---@public
---@return number 节点类型
function SkillMoveNode:GetType()
    return 68;
end

return SkillMoveNode;