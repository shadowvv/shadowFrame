---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiangxuechen
--- DateTime: 2022/06/16 16:33
--- Describe: 关卡检查发生元素附着
---

---@class LuaBehav_RuntimeTask_LevelCheckEleAttach : LuaBehav_RuntimeTask
LuaBehav_RuntimeTask_LevelCheckEleAttach = class(LuaBehav_RuntimeTask, "LuaBehav_RuntimeTask_LevelCheckEleAttach")

function LuaBehav_RuntimeTask_LevelCheckEleAttach:IsConditionalTask()
	return true
end

-- 
function LuaBehav_RuntimeTask_LevelCheckEleAttach:__RegistListener()
	self.__checkElementId = self.configTask.checkElementId
	self.__checkCampList = self.configTask.checkCampList
	self:RegistListenEvent(LuaBehav_Define_TaskListenEnum.EleAttach)
	self.__registed = true
end

function LuaBehav_RuntimeTask_LevelCheckEleAttach:OnListenEvent(_param)
	if self.__listen then return end
	if self.__checkElementId ~= _param.elementId then return end
	local _reactCamp = _param.reactCamp
	for _, _camp in pairs(self.__checkCampList) do
		if _camp == _reactCamp then
			self.__listen = true
			break
		end
	end
end

function LuaBehav_RuntimeTask_LevelCheckEleAttach:OnUpdate()
	if not self.__registed then
		self:__RegistListener()
	end
	
	local _retState = LuaBehav_Define_TaskState.Failure
	if self.__listen then
		_retState = LuaBehav_Define_TaskState.Success
	end

	self:__SetTaskState(_retState)
	return _retState
end

function LuaBehav_RuntimeTask_LevelCheckEleAttach:Clear()
	self:RemoveListenEvent(LuaBehav_Define_TaskListenEnum.EleAttach)
	self:__Clear()
	self.__registed = nil
	self.__checkElementId = nil
	self.__checkCampList = nil
end

return LuaBehav_RuntimeTask_LevelCheckEleAttach