---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiangxuechen
--- DateTime: 2022/07/19 15:33
--- Describe: 跟随召唤者，只有召唤物有效
---

---@class LuaBehav_ChaseSubordinateParam : table
LuaBehav_ChaseSubordinateParam = class(nil, "LuaBehav_ChaseSubordinateParam")
function LuaBehav_ChaseSubordinateParam:ctor(_netId, _configTask)
	self.netId = _netId
	self.chaseType = _configTask.chaseType
	self.posShift = _configTask.posShift
end

---@class LuaBehav_RuntimeTask_ChaseSubordinate : LuaBehav_RuntimeTask
LuaBehav_RuntimeTask_ChaseSubordinate = class(LuaBehav_RuntimeTask, "LuaBehav_RuntimeTask_ChaseSubordinate")

function LuaBehav_RuntimeTask_ChaseSubordinate:OnStart()
	----LogTools.LogByLevel(LogLevel.log, "CheckLuaBehav", "LuaBehav_RuntimeTask_ChaseSubordinate", "OnStart")
	self:__OnStart()
	self.__listen = false
	self:RegistListenEvent(LuaBehav_Define_TaskListenEnum.ChaseSubordinateEnd)
	if not self.__chaseParam then
		self.__chaseParam = LuaBehav_ChaseSubordinateParam.New(self.netId, self.configTask)
	end
	self.__callRet = BEHAVIOR_ACTION.MonsChaseSubordinate(self.battleId, self.__chaseParam)
end

---@public
function LuaBehav_RuntimeTask_ChaseSubordinate:OnListenEvent()
	self.__listen = true
end

---@public
-- 节点被打断时调用
function LuaBehav_RuntimeTask_ChaseSubordinate:OnAbort()
	--LogTools.LogByLevel(LogLevel.log, "CheckLuaBehav", "LuaBehav_RuntimeTask_ChaseSubordinate", "OnAbort", self.netId)
	self:__OnAbort()
	self.__listen = false
	self:RemoveListenEvent(LuaBehav_Define_TaskListenEnum.ChaseSubordinateEnd)
	BEHAVIOR_ACTION.MonsStopChaseSubordinate(self.battleId, self.netId)
end

---@public
function LuaBehav_RuntimeTask_ChaseSubordinate:OnUpdate(_deltaTime)
	if not self.__callRet then
		----LogTools.LogByLevel(LogLevel.log, "LuaBehav_RuntimeTask_ChaseSubordinate xxxx __OnMoveToPathPoint Failure")
		self:__SetTaskState(LuaBehav_Define_TaskState.Failure)
		return LuaBehav_Define_TaskState.Failure
	end

	local _netId = self.netId
	--监听到位置消息
	if self.__listen then
		self:__SetTaskState(LuaBehav_Define_TaskState.Success)
		BEHAVIOR_ACTION.MonsStopChaseSubordinate(self.battleId, _netId)
		--LogTools.LogByLevel(LogLevel.log, "CheckLuaBehav", "LuaBehav_RuntimeTask_ChaseSubordinate xxxx __OnMoveToPathPoint stop receive event _netId", _netId)
		return LuaBehav_Define_TaskState.Success
	end
	self:__SetTaskState(LuaBehav_Define_TaskState.Running)
	return LuaBehav_Define_TaskState.Running
end

---@public
-- 退出节点时调用
function LuaBehav_RuntimeTask_ChaseSubordinate:OnExit()
	--LogTools.LogByLevel(LogLevel.log, "CheckLuaBehav", "LuaBehav_RuntimeTask_ChaseSubordinate", "OnExit")
	self:__OnExit()
	self.__listen = false
	self:RemoveListenEvent(LuaBehav_Define_TaskListenEnum.ChaseSubordinateEnd)
end

return LuaBehav_RuntimeTask_ChaseSubordinate