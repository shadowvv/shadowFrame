---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiangxuechen
--- DateTime: 2022/10/18 16:44
--- Describe: 条件组节点
---

---@class LuaBehav_RuntimeTask_ConditionGroup : LuaBehav_RuntimeTask
LuaBehav_RuntimeTask_ConditionGroup = class(LuaBehav_RuntimeTask, "LuaBehav_RuntimeTask_ConditionGroup")

function LuaBehav_RuntimeTask_ConditionGroup:IsInterruptTask()
	return true
end

function LuaBehav_RuntimeTask_ConditionGroup:IsForceReevaluateTask()
	return true
end

-- 
function LuaBehav_RuntimeTask_ConditionGroup:OnStart()
	self:__OnStart()
	self.__needReevaluate = true
end

-- 
function LuaBehav_RuntimeTask_ConditionGroup:OnAbort()
	self.__needReevaluate = false
	self:__OnAbort()
end

-- 
function LuaBehav_RuntimeTask_ConditionGroup:OnExit()
	self.__needReevaluate = false
	self:__OnExit()
end

function LuaBehav_RuntimeTask_ConditionGroup:CheckCanExecute()
	local _stateList = self.childStateList
	
	if self.curExcuteChildCnt == #_stateList then return false end
	
	local _checkState_1 = LuaBehav_Define_TaskState.Abort
	local _hideList = self.childHideList
	for i = 1, #_stateList do
		if not _hideList[i] then
			local _childState = _stateList[i]
			if _checkState_1 == _childState then
				return false
			end
		end
	end
	
	return true
end

---@public
function LuaBehav_RuntimeTask_ConditionGroup:ReCountTaskState()
	local _state = LuaBehav_Define_TaskState.Success
	local _stateList = self.childStateList
	local _hideList = self.childHideList
	
	if self.configTask.checkType == LuaBehav_Define_ConditionGroupCheckType.All then
		for i = 1, #_stateList do
			if not _hideList[i] then
				local _childState = _stateList[i]
				--LogTools.LogByLevel(LogLevel.log, "CheckConditionGroup", "LuaBehav_RuntimeTask_ConditionGroup:ReCountTaskState", "i", i, "_childState", LogTools.GetEnumTableDesc(LuaBehav_Define_TaskState, _childState))
				if _childState ~= LuaBehav_Define_TaskState.Success then
					_state = LuaBehav_Define_TaskState.Running
					break
				end
			end
		end
	elseif self.configTask.checkType == LuaBehav_Define_ConditionGroupCheckType.Any then
		_state = LuaBehav_Define_TaskState.Running
		for i = 1, #_stateList do
			if not _hideList[i] then
				local _childState = _stateList[i]
				if _childState == LuaBehav_Define_TaskState.Success then
					_state = LuaBehav_Define_TaskState.Success
					break
				end
			end
		end
	end
	
	--LogTools.LogByLevel(LogLevel.log, "CheckConditionGroup", "LuaBehav_RuntimeTask_ConditionGroup:ReCountTaskState", "final state", LogTools.GetEnumTableDesc(LuaBehav_Define_TaskState, _state))
	self:__SetTaskState(_state)
	return _state
end

-- 
function LuaBehav_RuntimeTask_ConditionGroup:ForceReevaluate(_dt)
	if not self.__needReevaluate then return end
	if self.curExcuteChildCnt == #self.childStateList then
		self.curExcuteChildCnt = 0
	end
end

return LuaBehav_RuntimeTask_ConditionGroup