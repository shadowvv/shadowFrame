---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiangxuechen
--- DateTime: 2023/03/03 11:03
--- Describe: 物件检测受击
---

---@class LuaBehav_RuntimeTask_SceneObjCheckHit : LuaBehav_RuntimeTask
LuaBehav_RuntimeTask_SceneObjCheckHit = class(LuaBehav_RuntimeTask, "LuaBehav_RuntimeTask_SceneObjCheckHit")

function LuaBehav_RuntimeTask_SceneObjCheckHit:IsConditionalTask()
	return true
end

-- 
function LuaBehav_RuntimeTask_SceneObjCheckHit:__RegistListener()
	--LogTools.LogByLevel(LogLevel.log, "LuaBehav_RuntimeTask_SceneObjCheckHit", "__RegistListener")
	self.__checkCampList = self.configTask.checkCampList
	self.__checkWeaponList = self.configTask.checkWeaponList
	self.__checkElementList = self.configTask.checkElementList
	self:RegistListenEvent(LuaBehav_Define_TaskListenEnum.SceneObjHit)
	self.__registed = true
end

---@param _param SnapShotData
function LuaBehav_RuntimeTask_SceneObjCheckHit:OnListenEvent(_param)
	--LogTools.LogByLevel(LogLevel.log, "LuaBehav_RuntimeTask_SceneObjCheckHit", "OnListenEvent", "self.__listen", self.__listen)
	if self.__listen then return end
	if self:__CheckAny(self.__checkCampList, _param:GetFirstCamp()) and
			self:__CheckAny(self.__checkWeaponList, _param:GetWeaponType()) and
			self:__CheckAny(self.__checkElementList, _param:GetElementId()) then
		self.__listen = true
	end 
end

---@private
function LuaBehav_RuntimeTask_SceneObjCheckHit:__CheckAny(_list, _value)
	--LogTools.LogByLevel(LogLevel.log, "LuaBehav_RuntimeTask_SceneObjCheckHit", "_list", dumpTableEx(_list), "_value", _value)
	if #_list == 0 then return true end
	
	for _, _v in pairs(_list) do
		if _v == _value then
			return true
		end
	end
	return false
end

function LuaBehav_RuntimeTask_SceneObjCheckHit:OnUpdate()
	--LogTools.LogByLevel(LogLevel.log, "LuaBehav_RuntimeTask_SceneObjCheckHit", "OnUpdate", "self.__registed", self.__registed)
	if not self.__registed then
		self:__RegistListener()
	end
	
	local _retState = LuaBehav_Define_TaskState.Failure
	if self.__listen then
		_retState = LuaBehav_Define_TaskState.Success
	end

	self:__SetTaskState(_retState)
	return _retState
end

function LuaBehav_RuntimeTask_SceneObjCheckHit:Clear()
	self:RemoveListenEvent(LuaBehav_Define_TaskListenEnum.SceneObjHit)
	self:__Clear()
	self.__registed = nil
	self.__checkCampList = nil
	self.__checkWeaponList = nil
	self.__checkElementList = nil
end

return LuaBehav_RuntimeTask_SceneObjCheckHit