---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiangxuechen
--- DateTime: 2022/06/06 14:46
--- Describe: 关卡检查单位属性
---

---@class LuaBehav_RuntimeTask_LevelCheckUnitProp : LuaBehav_RuntimeTask
LuaBehav_RuntimeTask_LevelCheckUnitProp = class(LuaBehav_RuntimeTask, "LuaBehav_RuntimeTask_LevelCheckUnitProp")

function LuaBehav_RuntimeTask_LevelCheckUnitProp:IsConditionalTask()
	return true
end

function LuaBehav_RuntimeTask_LevelCheckUnitProp:OnUpdate()
	local _retState = LuaBehav_Define_TaskState.Failure
	--LogTools.LogByLevel(LogLevel.log, "checkProp", "self.configTask.targetType", self.configTask.targetType, "self.configTask.targetId", self.configTask.targetId, "self.configTask.propId", self.configTask.propId)
	local _objId = self.configTask.targetId
	if  self.configTask.targetType == LuaBehav_Define_LevelCheckUnitTargetType_2.PlayerUnit then
		local _unitList = self.battleRoom.battleUnitManager:GetUnitListByUnitType(BattleUnitType.Player)
		if 0 == #_unitList then
			self:__SetTaskState(_retState)
			return _retState
		end
		local _unit = _unitList[1]
		local _objList = _unit:GetTypeObjectList(BattleObjectType.LeaderHero)
		if 0 == #_objList then
			self:__SetTaskState(_retState)
			return _retState
		end
		local _obj = _objList[self.configTask.targetId]
		if not _obj then
			self:__SetTaskState(_retState)
			return _retState
		end
		_objId = _obj:GetObjectId()
	else
		local _levelUnit = self.battleRoom.battleLevelManager.levelUnitManager:GetLevelUnit(self.configTask.targetId)
		if not _levelUnit then
			--LogTools.LogByLevel(LogLevel.log, "checkProp", "not _levelUnit")
			self:__SetTaskState(_retState)
			return _retState
		end
		local _unit = self.battleRoom.battleUnitManager:GetUnit(_levelUnit.netId)
		if not _unit then
			--LogTools.LogByLevel(LogLevel.log, "checkProp", "not unit")
			self:__SetTaskState(_retState)
			return _retState
		end
		_objId = _unit:GetCurrentHeroObjectId()
	end
	self.__callRet, self.__getRet = BEHAVIOR_ACTION.GetObjectProp(self.battleId, _objId, self.configTask.propId, self.configTask.valueDescType)
	if not self.__callRet then
		--LogTools.LogByLevel(LogLevel.log, "checkProp", "not __callRet")
		self:__SetTaskState(_retState)
		return _retState
	end
	
	--LogTools.LogByLevel(LogLevel.log, "checkProp", "self.__getRet", self.__getRet, "self.configTask.compareValue", self.configTask.compareValue)
	local _compareType = self.configTask.compareType
	if _compareType == LuaBehav_Define_CompareType.Equal then
		if self.__getRet == self.configTask.compareValue then
			_retState = LuaBehav_Define_TaskState.Success
		end
	elseif _compareType == LuaBehav_Define_CompareType.UnEqual then
		if self.__getRet ~= self.configTask.compareValue then
			_retState = LuaBehav_Define_TaskState.Success
		end
	elseif _compareType == LuaBehav_Define_CompareType.Larger then
		if self.__getRet > self.configTask.compareValue then
			_retState = LuaBehav_Define_TaskState.Success
		end
	elseif _compareType == LuaBehav_Define_CompareType.Smaller then
		if self.__getRet < self.configTask.compareValue then
			_retState = LuaBehav_Define_TaskState.Success
		end
	elseif _compareType == LuaBehav_Define_CompareType.SmallerEqual then
		if self.__getRet <= self.configTask.compareValue then
			_retState = LuaBehav_Define_TaskState.Success
		end
	elseif _compareType == LuaBehav_Define_CompareType.LargerEqual then
		if self.__getRet >= self.configTask.compareValue then
			_retState = LuaBehav_Define_TaskState.Success
		end
	end
	
	self:__SetTaskState(_retState)
	----LogTools.LogByLevel(LogLevel.log, "LuaBehav_RuntimeTask_LevelCheckUnitDead", "_retState", --LogTools.GetEnumTableDesc(LuaBehav_Define_TaskState, _retState))
	return _retState
end

return LuaBehav_RuntimeTask_LevelCheckUnitProp