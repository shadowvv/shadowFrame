---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiangxuechen
--- DateTime: 2022/06/09 14:07
--- Describe: 关卡检查玩家控制器输入
---

---@class LuaBehav_RuntimeTask_LevelCheckPlayerController : LuaBehav_RuntimeTask
LuaBehav_RuntimeTask_LevelCheckPlayerController = class(LuaBehav_RuntimeTask, "LuaBehav_RuntimeTask_LevelCheckPlayerController")

function LuaBehav_RuntimeTask_LevelCheckPlayerController:IsConditionalTask()
	return true
end

function LuaBehav_RuntimeTask_LevelCheckPlayerController:OnStart()
	self:__OnStart()
end

function LuaBehav_RuntimeTask_LevelCheckPlayerController:OnListenEvent()
	--LogTools.LogByLevel(LogLevel.log, "LuaBehav_RuntimeTask_LevelCheckPlayerController", "OnListenEvent")
	self.__listen = true
end

---@private
function LuaBehav_RuntimeTask_LevelCheckPlayerController:__RegisListener()
	self.__listenEventId = nil
	
	local _listenType = self.configTask.checkType
	if _listenType == LuaBehav_Define_LevelListenPlayerControllerType.Move then
		self.__listenEventId = 	LuaBehav_Define_TaskListenEnum.Controll_Move
	elseif _listenType == LuaBehav_Define_LevelListenPlayerControllerType.Rotate then
		self.__listenEventId = 	LuaBehav_Define_TaskListenEnum.Controll_Rotate
	elseif _listenType == LuaBehav_Define_LevelListenPlayerControllerType.Shanbi then
		self.__listenEventId = 	LuaBehav_Define_TaskListenEnum.Controll_Shanbi
	elseif _listenType == LuaBehav_Define_LevelListenPlayerControllerType.CommonSkill then
		self.__listenEventId = 	LuaBehav_Define_TaskListenEnum.Controll_CommonSkill
	elseif _listenType == LuaBehav_Define_LevelListenPlayerControllerType.ActiveSkill then
		self.__listenEventId = 	LuaBehav_Define_TaskListenEnum.Controll_ActiveSkill
	elseif _listenType == LuaBehav_Define_LevelListenPlayerControllerType.JizouSkill then
		self.__listenEventId = 	LuaBehav_Define_TaskListenEnum.Controll_JizouSkill
	elseif _listenType == LuaBehav_Define_LevelListenPlayerControllerType.ChangePlayer then
		self.__listenEventId = 	LuaBehav_Define_TaskListenEnum.Controll_ChangePlayer
	elseif _listenType == LuaBehav_Define_LevelListenPlayerControllerType.ShanbiXiaodan then
		self.__listenEventId = 	LuaBehav_Define_TaskListenEnum.Controll_ShanbiXiaodan
	elseif _listenType == LuaBehav_Define_LevelListenPlayerControllerType.AutoFace then
		self.__listenEventId = 	LuaBehav_Define_TaskListenEnum.Controll_AutoFace
	elseif _listenType == LuaBehav_Define_LevelListenPlayerControllerType.Reload then
		self.__listenEventId = 	LuaBehav_Define_TaskListenEnum.Controll_Reload
	end

	if self.__listenEventId then
		self:RegistListenEvent(self.__listenEventId)
	end
	
	self.__registed = true
end

function LuaBehav_RuntimeTask_LevelCheckPlayerController:OnUpdate(_deltaTime)
	if not self.__registed then
		self:__RegisListener()
	end
	
	if not self.__listenEventId then
		self:__SetTaskState(LuaBehav_Define_TaskState.Failure)
		return LuaBehav_Define_TaskState.Failure
	end

	if self.__listen then
		--LogTools.LogByLevel(LogLevel.log, "LuaBehav_RuntimeTask_LevelCheckPlayerController", "success")
		self:__SetTaskState(LuaBehav_Define_TaskState.Success)
		return LuaBehav_Define_TaskState.Success
	end
	
	self:__SetTaskState(LuaBehav_Define_TaskState.Failure)
	return LuaBehav_Define_TaskState.Failure
end

-- 节点被打断时调用
function LuaBehav_RuntimeTask_LevelCheckPlayerController:OnAbort()
	self:__OnAbort()
	--self.__listen = false
	--self.__registed = nil
	--if self.__listenEventId then
	--	self:RemoveListenEvent(self.__listenEventId)
	--	self.__listenEventId = nil
	--end
end

-- 退出节点时调用
function LuaBehav_RuntimeTask_LevelCheckPlayerController:OnExit()
	self:__OnExit()
	--self.__listen = false
	--self.__registed = nil
	--if self.__listenEventId then
	--	self:RemoveListenEvent(self.__listenEventId)
	--	self.__listenEventId = nil
	--end
end

function LuaBehav_RuntimeTask_LevelCheckPlayerController:Clear()
	self.__listen = nil
	self.__registed = nil
	if self.__listenEventId then
		self:RemoveListenEvent(self.__listenEventId)
		self.__listenEventId = nil
	end
	self:__Clear()
end

return LuaBehav_RuntimeTask_LevelCheckPlayerController